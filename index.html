<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KTransport360 Driver</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            padding-bottom: 70px;
        }

        /* Dark Mode styles */
        body.dark-mode {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            color: #e2e8f0;
        }
        body.dark-mode .container,
        body.dark-mode .modal-content,
        body.dark-mode .settings-panel,
        body.dark-mode .customer-card,
        body.dark-mode .analytics-card,
        body.dark-mode .chart-container,
        body.dark-mode .feedback-item,
        body.dark-mode .export-card,
        body.dark-mode .ride-item {
            background: #2d3748; 
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
            border: none;
        }
        body.dark-mode .header {
            background: linear-gradient(135deg, #2a4365 0%, #3182ce 100%);
        }
        body.dark-mode .profile-info h3,
        body.dark-mode .feedback-section h3,
        body.dark-mode .customer-name,
        body.dark-mode .timeline-content,
        body.dark-mode .form-group label {
            color: #e2e8f0;
        }
        body.dark-mode .profile-info p,
        body.dark-mode .customer-rides,
        body.dark-mode .timeline-time,
        body.dark-mode .filter-tab,
        body.dark-mode .empty-state,
        body.dark-mode .analytics-label,
        body.dark-mode .feedback-item p {
            color: #a0aec0;
        }
        body.dark-mode .badge-warning {
            background: #ecc94b;
            color: #2d3748;
        }
        body.dark-mode .badge-success {
            background: #48bb78;
            color: #2d3748;
        }
        body.dark-mode .status-badge {
            background: #48bb78;
        }
        body.dark-mode .backup-status {
            background: #2f855a;
            color: #edf2f7;
        }
        body.dark-mode .sync-indicator {
            background: #48bb78;
        }
        body.dark-mode .form-group input,
        body.dark-mode .form-group select,
        body.dark-mode .form-group textarea,
        body.dark-mode .search-input {
            background: #4a5568;
            border-color: #4a5568;
            color: #e2e8f0;
        }
        body.dark-mode .form-group input:focus,
        body.dark-mode .form-group select:focus,
        body.dark-mode .form-group textarea:focus,
        body.dark-mode .search-input:focus {
            border-color: #667eea;
        }
        body.dark-mode .filter-tabs {
            background: #4a5568;
        }
        body.dark-mode .filter-tab {
            color: #e2e8f0;
        }
        body.dark-mode .filter-tab.active {
            background: #667eea;
            color: white;
        }
        body.dark-mode .bottom-nav {
            background: #2d3748;
            border-top-color: #4a5568;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.5);
        }
        body.dark-mode .nav-item {
            color: #a0aec0;
        }
        body.dark-mode .nav-item:hover,
        body.dark-mode .nav-item.active {
            color: #9f7aea;
        }
        body.dark-mode .export-icon {
            color: #9f7aea;
        }
        body.dark-mode .modal-content .close {
            color: #a0aec0;
        }
        body.dark-mode .modal-content .close:hover {
            color: #e2e8f0;
        }
        body.dark-mode .photo-upload {
            border-color: #4a5568;
        }
        body.dark-mode .photo-upload:hover {
            background: #4a5568;
        }
        body.dark-mode .success-message {
            background: #2f855a;
            color: #edf2f7;
            border-color: #48bb78;
        }
        body.dark-mode .error-message {
            background: #c53030;
            color: #fed7d7;
            border-color: #e53e3e;
        }

        .container {
            max-width: 420px;
            width: 100%;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            border-radius: 12px;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            border-bottom-left-radius: 12px;
            border-bottom-right-radius: 12px;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .header .subtitle {
            font-size: 14px;
            opacity: 0.9;
        }








         .truck-icon {
          display: inline-block;
          margin-right: 8px;
          vertical-align: middle;
}

          .logo-svg {
          vertical-align: middle;
}








        .status-badge {
            background: #4CAF50;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            margin: 15px auto 0;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .status-badge::before {
            content: "📱";
        }

        .main-content {
            padding: 20px;
        }

        .driver-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            position: relative;
        }

        .profile-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        .profile-info h3 {
            margin-bottom: 5px;
            color: #333;
        }

        .profile-info p {
            color: #666;
            font-size: 14px;
            margin-bottom: 3px;
        }

        .backup-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: #e8f5e8;
            color: #2e7d32;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .sync-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4caf50;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .earnings-summary {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            position: relative;
        }

        .earnings-today {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .earnings-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .ride-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .ride-card {
            padding: 20px;
            border-radius: 12px;
            color: white;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            overflow: hidden;
        }

        .ride-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .ride-card.today {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .ride-card.tomorrow {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .ride-card.future {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .ride-card.analytics {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            color: #333;
        }

        .ride-card-icon {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }

        .ride-card h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .ride-card p {
            font-size: 14px;
            opacity: 0.9;
        }

        .action-buttons {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            padding: 16px 20px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-decoration: none;
            color: white;
        }





.nav-buttons {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-top: 20px;
        }

        .nav-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.2s;
            background: #f8f9fa;
            color: #666;
        }

        .nav-btn:hover,
        .nav-btn.active {
            background: #667eea;
            color: white;
            transform: translateY(-1px);
        }






        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .btn-small {
            padding: 8px 12px;
            font-size: 12px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-edit {
            background: #ffc107;
            color: #333;
        }

        .btn-complete {
            background: #28a745;
            color: white;
        }

        .btn-cancel {
            background: #dc3545;
            color: white;
        }

        /* PLACE PART 2 CODE HERE */







Here's **Part 2 of 6** (CSS continuation - navigation, modals, forms, and UI components):

```css
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            max-width: 420px;
            width: 100%;
            background: white;
            border-top: 1px solid #eee;
            padding: 10px 0;
            display: flex;
            justify-content: space-around;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 999;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 12px;
            cursor: pointer;
            color: #666;
            transition: color 0.2s;
            text-decoration: none;
            font-size: 12px;
            flex: 1;
        }

        .nav-item:hover,
        .nav-item.active {
            color: #667eea;
        }

        .nav-item-icon {
            font-size: 18px;
            margin-bottom: 4px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal.open {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal.open .modal-content {
            transform: translateY(0);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 15px;
            top: 10px;
        }

        .close:hover {
            color: #000;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .ride-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .ride-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .ride-item h4 {
            color: #333;
            margin-bottom: 5px;
        }

        .ride-item p {
            color: #666;
            font-size: 14px;
            margin-bottom: 3px;
        }

        .ride-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .customer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .customer-card {
            background: white;
            border: 2px solid #eee;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .customer-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .customer-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #667eea;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        .customer-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .customer-rides {
            font-size: 12px;
            color: #666;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .analytics-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #eee;
        }

        .analytics-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .analytics-label {
            font-size: 14px;
            color: #666;
        }

        .chart-container {
            margin-top: 20px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #eee;
        }

        .communication-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .comm-btn {
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            transition: all 0.2s;
        }

        .comm-btn.call { background: #28a745; color: white; }
        .comm-btn.sms { background: #007bff; color: white; }
        .comm-btn.whatsapp { background: #25d366; color: white; }
        .comm-btn.email { background: #6c757d; color: white; }

        .comm-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .photo-upload {
            text-align: center;
            padding: 20px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .photo-upload:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .photo-preview {
            max-width: 100px;
            max-height: 100px;
            border-radius: 8px;
            margin: 10px auto 0;
            display: block;
        }

        .success-message, .error-message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 350px;
            padding: 12px;
            border-radius: 8px;
            z-index: 1000;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            animation: fadeInOut 4s forwards;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
            10% { opacity: 1; transform: translateX(-50%) translateY(0); }
            90% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            font-size: 12px;
            border-radius: 12px;
            font-weight: 600;
        }

        .badge-success { background: #d4edda; color: #155724; }
        .badge-warning { background: #fff3cd; color: #856404; }
        .badge-danger { background: #f8d7da; color: #721c24; }

        .floating-add {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.2s;
            z-index: 100;
        }

        .floating-add:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .ride-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-scheduled { background: #e3f2fd; color: #1976d2; }
        .status-in-progress { background: #fff3e0; color: #f57c00; }
        .status-completed { background: #e8f5e8; color: #388e3c; }
        .status-cancelled { background: #ffebee; color: #d32f2f; }

        .rating-stars {
            color: #ffc107;
            font-size: 16px;
            margin: 5px 0;
        }

        .feedback-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .feedback-item {
            background: white;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            border-left: 3px solid #667eea;
        }

        /* PLACE PART 3 CODE HERE */
```

.bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            max-width: 420px;
            width: 100%;
            background: white;
            border-top: 1px solid #eee;
            padding: 10px 0;
            display: flex;
            justify-content: space-around;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 999;
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 12px;
            cursor: pointer;
            color: #666;
            transition: color 0.2s;
            text-decoration: none;
            font-size: 12px;
            flex: 1;
        }

        .nav-item:hover,
        .nav-item.active {
            color: #667eea;
        }

        .nav-item-icon {
            font-size: 18px;
            margin-bottom: 4px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal.open {
            display: flex;
            opacity: 1;
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            transform: translateY(20px);
            transition: transform 0.3s ease;
        }

        .modal.open .modal-content {
            transform: translateY(0);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 15px;
            top: 10px;
        }

        .close:hover {
            color: #000;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .ride-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .ride-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .ride-item h4 {
            color: #333;
            margin-bottom: 5px;
        }

        .ride-item p {
            color: #666;
            font-size: 14px;
            margin-bottom: 3px;
        }

        .ride-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .customer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .customer-card {
            background: white;
            border: 2px solid #eee;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .customer-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .customer-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #667eea;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        .customer-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .customer-rides {
            font-size: 12px;
            color: #666;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .analytics-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #eee;
        }

        .analytics-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .analytics-label {
            font-size: 14px;
            color: #666;
        }

        .chart-container {
            margin-top: 20px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #eee;
        }

        .communication-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-top: 15px;
        }

        .comm-btn {
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            transition: all 0.2s;
        }

        .comm-btn.call { background: #28a745; color: white; }
        .comm-btn.sms { background: #007bff; color: white; }
        .comm-btn.whatsapp { background: #25d366; color: white; }
        .comm-btn.email { background: #6c757d; color: white; }

        .comm-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .photo-upload {
            text-align: center;
            padding: 20px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .photo-upload:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .photo-preview {
            max-width: 100px;
            max-height: 100px;
            border-radius: 8px;
            margin: 10px auto 0;
            display: block;
        }

        .success-message, .error-message {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 90%;
            max-width: 350px;
            padding: 12px;
            border-radius: 8px;
            z-index: 1000;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            animation: fadeInOut 4s forwards;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        @keyframes fadeInOut {
            0% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
            10% { opacity: 1; transform: translateX(-50%) translateY(0); }
            90% { opacity: 1; transform: translateX(-50%) translateY(0); }
            100% { opacity: 0; transform: translateX(-50%) translateY(-20px); }
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            font-size: 12px;
            border-radius: 12px;
            font-weight: 600;
        }

        .badge-success { background: #d4edda; color: #155724; }
        .badge-warning { background: #fff3cd; color: #856404; }
        .badge-danger { background: #f8d7da; color: #721c24; }

        .floating-add {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.2s;
            z-index: 100;
        }

        .floating-add:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .ride-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-scheduled { background: #e3f2fd; color: #1976d2; }
        .status-in-progress { background: #fff3e0; color: #f57c00; }
        .status-completed { background: #e8f5e8; color: #388e3c; }
        .status-cancelled { background: #ffebee; color: #d32f2f; }

        .rating-stars {
            color: #ffc107;
            font-size: 16px;
            margin: 5px 0;
        }

        .feedback-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .feedback-item {
            background: white;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            border-left: 3px solid #667eea;
        }

        /* PLACE PART 3 CODE HERE */


.map-container {
            height: 200px;
            background: #f0f0f0;
            border-radius: 8px;
            margin: 15px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 14px;
            text-align: center;
        }

        .distance-badge {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
        }




    .emergency-button {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 50px;
    height: 50px;
    background: #f44336;
    border: none;
    border-radius: 50%;
    color: white;
    font-size: 18px;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
    z-index: 1000;
    transition: all 0.2s;
}
.emergency-button:hover {
    transform: scale(1.1);
    background: #d32f2f;
}




.settings-panel {
    position: fixed;
    top: 0;
    right: -100%;
    width: 300px;
    max-width: 90vw; /* This ensures it never exceeds 90% of screen width */
    height: 100vh;
    background: white;
    box-shadow: -2px 0 10px rgba(0,0,0,0.1);
    transition: right 0.3s ease;
    z-index: 1001;
    padding: 20px;
    overflow-y: auto;
}

.settings-panel.open {
    right: 0;
}

/* Mobile-specific adjustments */
@media (max-width: 480px) {
    .settings-panel {
        width: 280px; /* Slightly smaller on very small screens */
        max-width: 85vw;
        padding: 15px; /* Reduce padding on mobile */
    }
}
   



      .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
            cursor: pointer;
        }







        .toggle-switch {
            position: relative;
            width: 50px;
            height: 25px;
            background: #ccc;
            border-radius: 25px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: #667eea;
        }

        .toggle-knob {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 21px;
            height: 21px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .toggle-switch.active .toggle-knob {
            transform: translateX(25px);
        }

        .offline-banner {
            background: #ff9800;
            color: white;
            padding: 10px;
            text-align: center;
            font-size: 14px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1002;
            display: none;
        }

        .voice-command-btn {
            position: fixed;
            bottom: 150px;
            left: 20px;
            width: 50px;
            height: 50px;
            background: #9c27b0;
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(156, 39, 176, 0.3);
            z-index: 100;
            transition: all 0.2s;
        }

        .voice-command-btn:hover {
            transform: scale(1.1);
        }

        .voice-command-btn.listening {
            background: #e91e63;
            animation: pulse 1s infinite;
        }

        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .export-card {
            background: white;
            border: 2px solid #eee;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .export-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .export-icon {
            font-size: 32px;
            margin-bottom: 10px;
            color: #667eea;
        }

        .search-bar {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 40px 12px 15px;
            border: 2px solid #eee;
            border-radius: 25px;
            font-size: 16px;
            transition: border-color 0.2s;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }

        .filter-tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 25px;
            padding: 4px;
            margin-bottom: 20px;
        }

        .filter-tab {
            flex: 1;
            padding: 10px 15px;
            text-align: center;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            font-weight: 600;
        }

        .filter-tab.active {
            background: #667eea;
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .priority-high { border-left-color: #dc3545 !important; }
        .priority-medium { border-left-color: #ffc107 !important; }
        .priority-low { border-left-color: #28a745 !important; }

        .timeline {
            position: relative;
            padding-left: 30px;
            margin-top: 20px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #eee;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -22px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #667eea;
        }

        .timeline-time {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .timeline-content {
            font-weight: 600;
            color: #333;
        }

        .stats-overview {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .stats-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stats-row:last-child {
            margin-bottom: 0;
        }

        .stat-item {
            text-align: center;
            flex: 1;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            display: block;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }

        .settings-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
            display: none;
        }

        .settings-overlay.open {
            display: block;
        }

        @media (max-width: 480px) {
            .ride-cards {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                margin: 10% auto;
                width: 95%;
            }
            
            .customer-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }

            .settings-panel {
                width: 100%;
            }
        }

        .custom-alert-modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.6);
            backdrop-filter: blur(8px);
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .custom-alert-modal.show {
            display: flex;
            opacity: 1;
        }

        .custom-alert-content {
            background-color: white;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            transform: translateY(-20px);
            transition: transform 0.3s ease;
        }

        .custom-alert-modal.show .custom-alert-content {
            transform: translateY(0);
        }

        .custom-alert-content h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 20px;
        }

        .custom-alert-content p {
            color: #666;
            margin-bottom: 25px;
            font-size: 15px;
        }

        .custom-alert-buttons {
            display: flex;
            justify-content: center;
            gap: 15px;
        }

        .custom-alert-btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            transition: background 0.2s, transform 0.2s;
        }

        .custom-alert-btn.confirm {
            background: #28a745;
            color: white;
        }

        .custom-alert-btn.cancel {
            background: #dc3545;
            color: white;
        }

        .custom-alert-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        body.dark-mode .custom-alert-content {
            background-color: #2d3748;
            color: #e2e8f0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        body.dark-mode .custom-alert-content h3 {
            color: #e2e8f0;
        }
        body.dark-mode .custom-alert-content p {
            color: #a0aec0;
        }
    </style>
</head>
<body>

    <!-- Custom Alert/Confirm Modal Structure -->
    <div id="customAlertModal" class="custom-alert-modal">
        <div class="custom-alert-content">
            <h3 id="customAlertTitle"></h3>
            <p id="customAlertMessage"></p>
            <div class="custom-alert-buttons">
                <button id="customAlertConfirmBtn" class="custom-alert-btn confirm">OK</button>
                <button id="customAlertCancelBtn" class="custom-alert-btn cancel">Cancel</button>
            </div>
        </div>
    </div>

    <div class="offline-banner" id="offlineBanner">
        📡 You're offline. Data will sync when connection is restored.
    </div>

    <!-- Settings Panel Overlay -->
    <div id="settingsOverlay" class="settings-overlay" onclick="closeSettings()"></div>

    <div class="container">
        <!-- Emergency Button -->
        <button class="emergency-button" onclick="triggerEmergency()" title="Emergency" style="top: 150px;">
            🚨
        </button>

        <!-- Settings Button -->
        <button class="emergency-button" onclick="toggleSettings()" title="Settings" style="top: 80px; background: #667eea;">
            ⚙️
        </button>




        <!-- Header -->
        <div class="header">
           

           <h1>
               <span class="truck-icon">
   <span class="truck-icon">
    <svg width="28" height="28" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg" class="logo-svg">
        <!-- Green background circle -->
        <circle cx="50" cy="50" r="48" fill="#4CAF50" stroke="#FF0000" stroke-width="2"/>
        
        <!-- Red car body -->
        <g transform="translate(50,50) scale(0.8)">
            <!-- Main car body -->
            <path d="M -20 -8 L -15 -15 L 15 -15 L 20 -8 L 20 8 L -20 8 Z" fill="#FF0000" stroke="#000" stroke-width="1"/>
            
            <!-- Windshield -->
            <path d="M -15 -15 L -10 -20 L 10 -20 L 15 -15 Z" fill="#333" stroke="#000" stroke-width="1"/>
            
            <!-- Hood lines -->
            <line x1="-5" y1="-15" x2="-5" y2="-8" stroke="#000" stroke-width="1"/>
            <line x1="0" y1="-15" x2="0" y2="-8" stroke="#000" stroke-width="1"/>
            <line x1="5" y1="-15" x2="5" y2="-8" stroke="#000" stroke-width="1"/>
            
            <!-- Headlights -->
            <rect x="-18" y="-6" width="3" height="4" fill="#FFFF00" stroke="#000" stroke-width="0.5"/>
            <rect x="15" y="-6" width="3" height="4" fill="#FFFF00" stroke="#000" stroke-width="0.5"/>
            
            <!-- Grille -->
            <rect x="-12" y="-8" width="24" height="4" fill="#000"/>
            <line x1="-10" y1="-6" x2="10" y2="-6" stroke="#333" stroke-width="0.5"/>
            
            <!-- Wheels -->
            <circle cx="-12" cy="10" r="4" fill="#333" stroke="#000" stroke-width="1"/>
            <circle cx="12" cy="10" r="4" fill="#333" stroke="#000" stroke-width="1"/>
            <circle cx="-12" cy="10" r="2" fill="#666"/>
            <circle cx="12" cy="10" r="2" fill="#666"/>
            
            <!-- Side mirrors -->
            <rect x="-22" y="-12" width="2" height="3" fill="#FF0000" stroke="#000" stroke-width="0.5"/>
            <rect x="20" y="-12" width="2" height="3" fill="#FF0000" stroke="#000" stroke-width="0.5"/>
        </g>
    </svg>
</span>
                KTransport360 Driver
            </h1>
           

            <p class="subtitle">Simple & Reliable Transport Management</p>
            <div class="status-badge">
                App Ready - All data saved on your phone
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Driver Profile -->
            <div class="driver-profile">
                <div class="profile-avatar" id="driverAvatar">JD</div>
                <div class="profile-info">
                    <h3 id="driverName">John Driver</h3>
                    <p id="driverPhone">📞 +1 (555) 123-4567</p>
                    <p id="driverVehicle">🚗 Toyota Camry - ABC123</p>
                    <div class="rating-stars" id="driverRating">
                        ⭐⭐⭐⭐⭐ 4.8
                    </div>
                </div>
                <button class="btn-small btn-edit" onclick="showEditProfileModal()" style="position: absolute; top: 10px; right: 10px;" title="Edit Profile">
                    ✏️ Edit
                </button>
            </div>




            <!-- Backup Status -->
            <div class="backup-status">
                <div class="sync-indicator"></div>
                <span>All data synced and backed up locally</span>
            </div>

            <!-- Earnings Summary -->
            <div class="earnings-summary">
                <div class="earnings-today" id="earningsToday">$0.00</div>
                <div class="earnings-label">Today's Earnings</div>
                <button class="btn-small btn-edit" onclick="showResetEarningsModal()" style="position: absolute; top: 10px; right: 10px; background: #ff6b6b; color: white;" title="Reset Earnings">
                    🔄 Reset
                </button>
            </div>

            <!-- PLACE PART 4 CODE HERE -->



<!-- Ride Cards -->
            <div class="ride-cards">
                <div class="ride-card today" onclick="showTodaysRides()">
                    <span class="ride-card-icon">📅</span>
                    <h3>TODAY'S</h3>
                    <p>RIDES</p>
                    <div class="notification-badge" id="todaysBadge">0</div>
                </div>
                <div class="ride-card tomorrow" onclick="showTomorrowsRides()">
                    <span class="ride-card-icon">📆</span>
                    <h3>TOMORROW'S</h3>
                    <p>RIDES</p>
                    <div class="notification-badge" id="tomorrowsBadge">0</div>
                </div>
                <div class="ride-card future" onclick="showFutureRides()">
                    <span class="ride-card-icon">🔮</span>
                    <h3>FUTURE</h3>
                    <p>RIDES</p>
                </div>
                <div class="ride-card analytics" onclick="showAnalytics()">
                    <span class="ride-card-icon">📊</span>
                    <h3>ANALYTICS</h3>
                    <p>& INSIGHTS</p>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="showAddRideModal()">
                    ➕ Add New Ride
                </button>
                <button class="btn btn-secondary" onclick="exportData()">
                    📤 Export Data for Spreadsheet
                </button>
            </div>

            <!-- Navigation Buttons -->
            <div class="nav-buttons">
                <button class="nav-btn active" onclick="showHome()">🏠 Home</button>
                <button class="nav-btn" onclick="showToday()">📅 Today</button>
                <button class="nav-btn" onclick="showTomorrow()">📆 Tomorrow</button>
                <button class="nav-btn" onclick="showFuture()">🔮 Future</button>
                <button class="nav-btn" onclick="showAnalytics()">📊 Analytics</button>
                <button class="nav-btn" onclick="showCustomers()">👥 Customers</button>
            </div>
        </div>

        <!-- Voice Command Button -->
        <button class="voice-command-btn" id="voiceBtn" onclick="toggleVoiceCommand()" title="Voice Command">
            🎤
        </button>

        <!-- Floating Add Button -->
        <button class="floating-add" onclick="showAddRideModal()" title="Add New Ride">
            ➕
        </button>
    </div>

    <!-- Reset Earnings Modal -->
    <div id="resetEarningsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('resetEarningsModal')">&times;</span>
            <h2>🔄 Reset Earnings</h2>
            <p style="color: #666; margin-bottom: 20px;">Choose how you want to reset your earnings:</p>
            
            <div class="export-options">
                <div class="export-card" onclick="resetDisplayOnly()">
                    <div class="export-icon">📊</div>
                    <h3>Reset Display Only</h3>
                    <p>Reset the displayed amount to $0.00 but keep all your ride data intact. Use this to fix the display baseline.</p>
                </div>
                <div class="export-card" onclick="resetAllEarnings()">
                    <div class="export-icon">🗑️</div>
                    <h3>Reset All Earnings</h3>
                    <p><strong style="color: #d32f2f;">⚠️ PERMANENT:</strong> This will erase all earnings data and completed rides from the system.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit Profile Modal -->
    <div id="editProfileModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('editProfileModal')">&times;</span>
            <h2>✏️ Edit Driver Profile</h2>
            <form id="editProfileForm" onsubmit="updateDriverProfile(event)">
                <div class="form-group">
                    <label for="profileName">Driver Name:</label>
                    <input type="text" id="profileName" required placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label for="profilePhone">Phone Number:</label>
                    <input type="tel" id="profilePhone" required placeholder="+1 (555) 123-4567">
                </div>
                <div class="form-group">
                    <label for="profileEmail">Email Address:</label>
                    <input type="email" id="profileEmail" placeholder="your.email@example.com">
                </div>
                <div class="form-group">
                    <label for="profileVehicleMake">Vehicle Make & Model:</label>
                    <input type="text" id="profileVehicleMake" required placeholder="Toyota Camry">
                </div>
                <div class="form-group">
                    <label for="profileLicensePlate">License Plate:</label>
                    <input type="text" id="profileLicensePlate" required placeholder="ABC123">
                </div>
                <div class="form-group">
                    <label for="profileLicenseNumber">Driver's License Number:</label>
                    <input type="text" id="profileLicenseNumber" placeholder="D1234567890">
                </div>
                <div class="form-group">
                    <label for="profileInsurance">Insurance Company:</label>
                    <input type="text" id="profileInsurance" placeholder="State Farm, Geico, etc.">
                </div>
                <div class="form-group">
                    <label for="profileEmergencyContact">Emergency Contact:</label>
                    <input type="text" id="profileEmergencyContact" placeholder="Name and phone number">
                </div>
                <div class="form-group">
                    <label for="profilePhoto">Profile Photo:</label>
                    <div class="photo-upload" onclick="document.getElementById('profilePhotoInput').click()">
                        <input type="file" id="profilePhotoInput" accept="image/*" style="display: none;" onchange="handleProfilePhotoUpload(event)">
                        <p>📷 Tap to update profile photo</p>
                        <img id="profilePhotoPreview" class="photo-preview" style="display: none;">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">
                    ✅ Save Profile
                </button>
                <button type="button" class="btn btn-secondary" onclick="resetToDefaults()" style="width: 100%; margin-top: 10px;">
                    🔄 Reset to Defaults
                </button>
            </form>
        </div>
    </div>

    <!-- Add Ride Modal -->
    <div id="addRideModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addRideModal')">&times;</span>
            <h2>➕ Add New Ride</h2>
            <form id="addRideForm" onsubmit="addRide(event)">
                <div class="form-group">
                    <label for="customerName">Customer Name:</label>
                    <input type="text" id="customerName" required>
                </div>
                <div class="form-group">
                    <label for="customerPhone">Phone Number:</label>
                    <input type="tel" id="customerPhone" required>
                </div>
                <div class="form-group">
                    <label for="customerEmail">Email (Optional):</label>
                    <input type="email" id="customerEmail">
                </div>
                <div class="form-group">
                    <label for="pickupLocation">Pickup Location:</label>
                    <input type="text" id="pickupLocation" required>
                </div>
                <div class="form-group">
                    <label for="dropoffLocation">Drop-off Location:</label>
                    <input type="text" id="dropoffLocation" required>
                </div>
                <div class="form-group">
                    <label for="rideDate">Date:</label>
                    <input type="date" id="rideDate" required>
                </div>
                <div class="form-group">
                    <label for="rideTime">Time:</label>
                    <input type="time" id="rideTime" required>
                </div>
                <div class="form-group">
                    <label for="ridePrice">Price ($):</label>
                    <input type="number" id="ridePrice" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="ridePriority">Priority:</label>
                    <select id="ridePriority">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="rideNotes">Notes (Optional):</label>
                    <textarea id="rideNotes" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="customerPhoto">Customer Photo (Optional):</label>
                    <div class="photo-upload" onclick="document.getElementById('customerPhotoInput').click()">
                        <input type="file" id="customerPhotoInput" accept="image/*" style="display: none;" onchange="handlePhotoUpload(event)">
                        <p>📷 Tap to add customer photo</p>
                        <img id="photoPreview" class="photo-preview" style="display: none;">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">
                    ✅ Add Ride
                </button>
            </form>
        </div>
    </div>

    <!-- Rides Modal -->
    <div id="ridesModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('ridesModal')">&times;</span>
            <h2 id="ridesModalTitle">📅 Rides</h2>
            
            <!-- Search Bar -->
            <div class="search-bar">
                <input type="text" class="search-input" id="ridesSearch" placeholder="Search rides..." onkeyup="filterRides()">
                <span class="search-icon">🔍</span>
            </div>

            <!-- Filter Tabs -->
            <div class="filter-tabs">
                <div class="filter-tab active" onclick="filterRidesByStatus('all')">All</div>
                <div class="filter-tab" onclick="filterRidesByStatus('scheduled')">Scheduled</div>
                <div class="filter-tab" onclick="filterRidesByStatus('in-progress')">In Progress</div>
                <div class="filter-tab" onclick="filterRidesByStatus('completed')">Completed</div>
                <div class="filter-tab" onclick="filterRidesByStatus('cancelled')">Cancelled</div>
            </div>

            <div class="ride-list" id="ridesList">
                <!-- Rides will be populated here by JavaScript -->
            </div>
        </div>
    </div>






    <!-- PLACE PART 5 CODE HERE -->
<!-- Analytics Modal -->
    <div id="analyticsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('analyticsModal')">&times;</span>
            <h2>📊 Analytics & Insights</h2>
            
            <!-- Stats Overview -->
            <div class="stats-overview">
                <div class="stats-row">
                    <div class="stat-item">
                        <span class="stat-value" id="totalRides">0</span>
                        <span class="stat-label">Total Rides</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="totalEarnings">$0.00</span>
                        <span class="stat-label">Total Earnings</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="avgRating">4.8</span>
                        <span class="stat-label">Avg Rating</span>
                    </div>
                </div>
                <div class="stats-row">
                    <div class="stat-item">
                        <span class="stat-value" id="repeatCustomers">0</span>
                        <span class="stat-label">Repeat Customers</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="thisWeekRides">0</span>
                        <span class="stat-label">This Week</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="avgPrice">$0.00</span>
                        <span class="stat-label">Avg Price</span>
                    </div>
                </div>
            </div>

            <!-- Analytics Cards -->
            <div class="analytics-grid">
                <div class="analytics-card">
                    <div class="analytics-value" id="todayRides">0</div>
                    <div class="analytics-label">Today's Rides</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-value" id="weeklyEarnings">$0.00</div>
                    <div class="analytics-label">This Week</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-value" id="monthlyRides">0</div>
                    <div class="analytics-label">This Month</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-value" id="customerSatisfaction">96%</div>
                    <div class="analytics-label">Satisfaction</div>
                </div>
            </div>

            <!-- Chart Container -->
            <div class="chart-container">
                <h3>📈 Weekly Performance</h3>
                <canvas id="performanceChart" width="400" height="200"></canvas>
            </div>

            <!-- Top Customers -->
            <div class="chart-container">
                <h3>⭐ Top Customers This Month</h3>
                <div id="topCustomers">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>

            <!-- Recent Feedback -->
            <div class="feedback-section">
                <h3>💬 Recent Customer Feedback</h3>
                <div class="feedback-item">
                    <div class="rating-stars">⭐⭐⭐⭐⭐</div>
                    <p>"Excellent service! Very punctual and professional." - Sarah M.</p>
                </div>
                <div class="feedback-item">
                    <div class="rating-stars">⭐⭐⭐⭐⭐</div>
                    <p>"Clean vehicle and safe driving. Highly recommend!" - Mike R.</p>
                </div>
                <div class="feedback-item">
                    <div class="rating-stars">⭐⭐⭐⭐⭐</div>
                    <p>"Always on time and very friendly driver." - Jennifer L.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Customers Modal -->
    <div id="customersModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('customersModal')">&times;</span>
            <h2>👥 Customer Management</h2>
            
            <!-- Search Bar -->
            <div class="search-bar">
                <input type="text" class="search-input" id="customersSearch" placeholder="Search customers..." onkeyup="filterCustomers()">
                <span class="search-icon">🔍</span>
            </div>

            <!-- Filter Tabs -->
            <div class="filter-tabs">
                <div class="filter-tab active" onclick="filterCustomersByType('all')">All</div>
                <div class="filter-tab" onclick="filterCustomersByType('repeat')">Repeat</div>
                <div class="filter-tab" onclick="filterCustomersByType('new')">New</div>
                <div class="filter-tab" onclick="filterCustomersByType('vip')">VIP</div>
            </div>

            <div class="customer-grid" id="customersGrid">
                <!-- Customers will be populated here by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Customer Details Modal -->
    <div id="customerDetailsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('customerDetailsModal')">&times;</span>
            <h2 id="customerDetailsTitle">👤 Customer Details</h2>
            
            <div id="customerDetailsContent">
                <!-- Customer details will be populated here by JavaScript -->
            </div>

            <!-- Communication Buttons -->
            <div class="communication-buttons">
                <button class="comm-btn call" onclick="callCustomer()">
                    📞 Call
                </button>
                <button class="comm-btn sms" onclick="smsCustomer()">
                    💬 SMS
                </button>
                <button class="comm-btn whatsapp" onclick="whatsappCustomer()">
                    📱 WhatsApp
                </button>
                <button class="comm-btn email" onclick="emailCustomer()">
                    ✉️ Email
                </button>
            </div>

            <!-- Ride History -->
            <div class="chart-container">
                <h3>🚗 Ride History</h3>
                <div id="customerRideHistory">
                    <!-- Ride history will be populated here by JavaScript -->
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('exportModal')">&times;</span>
            <h2>📤 Export Data</h2>
            
            <div class="export-options">
                <div class="export-card" onclick="exportToCSV()">
                    <div class="export-icon">📊</div>
                    <h3>CSV Spreadsheet</h3>
                    <p>Export all ride data to CSV format for Excel or Google Sheets</p>
                </div>
                <div class="export-card" onclick="exportToPDF()">
                    <div class="export-icon">📄</div>
                    <h3>PDF Report</h3>
                    <p>Generate a comprehensive PDF report with analytics</p>
                </div>
                <div class="export-card" onclick="exportCustomers()">
                    <div class="export-icon">👥</div>
                    <h3>Customer List</h3>
                    <p>Export customer database with contact information</p>
                </div>
                <div class="export-card" onclick="backupData()">
                    <div class="export-icon">💾</div>
                    <h3>Backup Data</h3>
                    <p>Create a complete backup of all your data</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Panel -->
    <div id="settingsPanel" class="settings-panel">
        <h2>⚙️ Settings</h2>
        
        <div class="settings-item" onclick="showEditProfileModal(); closeSettings();" style="cursor: pointer;">
            <span>👤 Edit Driver Profile</span>
            <span style="color: #667eea;">✏️</span>
        </div>
        
        <div class="settings-item">
            <span>Dark Mode</span>
            <div class="toggle-switch" onclick="toggleDarkMode()">
                <div class="toggle-knob"></div>
            </div>
        </div>
        
        <div class="settings-item">
            <span>Notifications</span>
            <div class="toggle-switch active" onclick="toggleNotifications()">
                <div class="toggle-knob"></div>
            </div>
        </div>
        
        <div class="settings-item">
            <span>Auto Backup</span>
            <div class="toggle-switch active" onclick="toggleAutoBackup()">
                <div class="toggle-knob"></div>
            </div>
        </div>
        
        <div class="settings-item">
            <span>Voice Commands</span>
            <div class="toggle-switch" onclick="toggleVoiceCommands()">
                <div class="toggle-knob"></div>
            </div>
        </div>
        
        <div class="settings-item">
            <span>GPS Tracking</span>
            <div class="toggle-switch active" onclick="toggleGPSTracking()">
                <div class="toggle-knob"></div>
            </div>
        </div>
        
        <button class="btn btn-secondary" onclick="resetAppData()" style="width: 100%; margin-top: 20px;">
            🔄 Reset App Data
        </button>
    </div>

    <script>
        // --- Global Variables ---
        let rides = [];
        let customers = [];
        let analytics = {};
        let currentCustomer = null;
        let isVoiceListening = false;
        let currentFilter = 'all';
        let isDarkMode = false;
        let dailyEarningsOffset = 0;
        let driverProfile = {
            name: 'John Driver',
            phone: '+1 (555) 123-4567',
            email: 'john.driver@email.com',
            vehicleMake: 'Toyota Camry',
            licensePlate: 'ABC123',
            licenseNumber: '',
            insurance: '',
            emergencyContact: '',
            photo: null,
            rating: 4.8
        };

        // --- Utility Functions for Custom Modals ---
        function showAlert(title, message) {
            const modal = document.getElementById('customAlertModal');
            document.getElementById('customAlertTitle').textContent = title;
            document.getElementById('customAlertMessage').textContent = message;
            document.getElementById('customAlertConfirmBtn').style.display = 'block';
            document.getElementById('customAlertCancelBtn').style.display = 'none';
            modal.classList.add('show');

            return new Promise(resolve => {
                document.getElementById('customAlertConfirmBtn').onclick = () => {
                    modal.classList.remove('show');
                    resolve(true);
                };
            });
        }

        function showConfirm(title, message) {
            const modal = document.getElementById('customAlertModal');
            document.getElementById('customAlertTitle').textContent = title;
            document.getElementById('customAlertMessage').textContent = message;
            document.getElementById('customAlertConfirmBtn').style.display = 'block';
            document.getElementById('customAlertCancelBtn').style.display = 'block';
            modal.classList.add('show');

            return new Promise(resolve => {
                document.getElementById('customAlertConfirmBtn').onclick = () => {
                    modal.classList.remove('show');
                    resolve(true);
                };
                document.getElementById('customAlertCancelBtn').onclick = () => {
                    modal.classList.remove('show');
                    resolve(false);
                };
            });
        }

        // --- App Initialization ---
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            loadSampleData();
            updateAnalytics();
            setTodaysDate();
            checkOfflineStatus();
        });

        function initializeApp() {
            console.log('KTransport360 Driver App initialized successfully!');
            
            isDarkMode = localStorage.getItem('darkMode') === 'true';
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
                const darkModeToggle = document.querySelector('.settings-panel .toggle-switch');
                if (darkModeToggle) {
                    darkModeToggle.classList.add('active');
                }
            }

            loadDriverProfile();
            updateDriverProfileDisplay();

            const savedOffset = localStorage.getItem('ktransport360_earningsOffset');
            if (savedOffset) {
                dailyEarningsOffset = parseFloat(savedOffset);
            }

            setTodaysDate();
            updateNotificationBadges();
        }

        // --- Data Loading and Saving ---
        function loadSampleData() {
            const savedRides = localStorage.getItem('ktransport360_rides');
            const savedCustomers = localStorage.getItem('ktransport360_customers');

            if (savedRides) {
                rides = JSON.parse(savedRides);
            } else {
                rides = [];
                saveRides();
            }

            if (savedCustomers) {
                customers = JSON.parse(savedCustomers);
            } else {
                customers = [];
                saveCustomers();
            }
            console.log('Data loaded successfully');
        }

        function saveRides() {
            localStorage.setItem('ktransport360_rides', JSON.stringify(rides));
        }

        function saveCustomers() {
            localStorage.setItem('ktransport360_customers', JSON.stringify(customers));
        }

        function loadDriverProfile() {
            const savedProfile = localStorage.getItem('ktransport360_driverProfile');
            if (savedProfile) {
                driverProfile = JSON.parse(savedProfile);
            }
        }

        function saveDriverProfile() {
            localStorage.setItem('ktransport360_driverProfile', JSON.stringify(driverProfile));
        }

        // --- UI Updates ---
        function updateDriverProfileDisplay() {
            document.getElementById('driverAvatar').textContent = driverProfile.name.split(' ').map(n => n[0]).join('');
            document.getElementById('driverName').textContent = driverProfile.name;
            document.getElementById('driverPhone').textContent = `📞 ${driverProfile.phone}`;
            document.getElementById('driverVehicle').textContent = `🚗 ${driverProfile.vehicleMake} - ${driverProfile.licensePlate}`;
            document.getElementById('driverRating').innerHTML = `⭐⭐⭐⭐⭐ ${driverProfile.rating}`;
        }

        function setTodaysDate() {
            const today = new Date().toISOString().split('T')[0];
            const dateInput = document.getElementById('rideDate');
            if (dateInput) {
                dateInput.value = today;
                dateInput.min = today;
            }
        }

        function updateNotificationBadges() {
            const today = new Date().toISOString().split('T')[0];
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowStr = tomorrow.toISOString().split('T')[0];

            const todaysRidesCount = rides.filter(ride => ride.date === today && ride.status === 'scheduled').length;
            const tomorrowsRidesCount = rides.filter(ride => ride.date === tomorrowStr && ride.status === 'scheduled').length;

            const todaysBadge = document.getElementById('todaysBadge');
            const tomorrowsBadge = document.getElementById('tomorrowsBadge');

            if (todaysRidesCount > 0) {
                todaysBadge.textContent = todaysRidesCount;
                todaysBadge.style.display = 'flex';
            } else {
                todaysBadge.style.display = 'none';
            }

            if (tomorrowsRidesCount > 0) {
                tomorrowsBadge.textContent = tomorrowsRidesCount;
                tomorrowsBadge.style.display = 'flex';
            } else {
                tomorrowsBadge.style.display = 'none';
            }
        }

        function showSuccessMessage(message) {
            const successDiv = document.createElement('div');
            successDiv.className = 'success-message';
            successDiv.textContent = message;
            document.body.appendChild(successDiv);
            setTimeout(() => {
                successDiv.remove();
            }, 4000);
        }

        function showErrorMessage(message) {
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.textContent = message;
            document.body.appendChild(errorDiv);
            setTimeout(() => {
                errorDiv.remove();
            }, 4000);
        }

        // PLACE PART 6 CODE HERE -->


// --- Navigation Functions ---
        function showHome() {
            setActiveNav(0);
        }

        function showToday() {
            setActiveNav(1);
            showTodaysRides();
        }

        function showTomorrow() {
            setActiveNav(2);
            showTomorrowsRides();
        }

        function showFuture() {
            setActiveNav(3);
            showFutureRides();
        }

        function showAnalytics() {
            setActiveNav(4);
            updateAnalytics();
            document.getElementById('analyticsModal').classList.add('open');
            drawPerformanceChart();
            displayTopCustomers();
        }

        function showCustomers() {
            setActiveNav(5);
            displayCustomers(customers);
            document.getElementById('customersModal').classList.add('open');
        }

        function setActiveNav(index) {
            const navItems = document.querySelectorAll('.bottom-nav .nav-item');
            navItems.forEach((item, i) => {
                if (i === index) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }

        function showTodaysRides() {
            const today = new Date().toISOString().split('T')[0];
            const todaysRides = rides.filter(ride => ride.date === today);
            document.getElementById('ridesModalTitle').textContent = "📅 Today's Rides";
            displayRides(todaysRides);
            document.getElementById('ridesModal').classList.add('open');
            currentFilter = 'all';
            resetFilterTabs();
        }

        function showTomorrowsRides() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowStr = tomorrow.toISOString().split('T')[0];
            const tomorrowsRides = rides.filter(ride => ride.date === tomorrowStr);
            document.getElementById('ridesModalTitle').textContent = "📆 Tomorrow's Rides";
            displayRides(tomorrowsRides);
            document.getElementById('ridesModal').classList.add('open');
            currentFilter = 'all';
            resetFilterTabs();
        }

        function showFutureRides() {
            const dayAfterTomorrow = new Date();
            dayAfterTomorrow.setDate(dayAfterTomorrow.getDate() + 2);
            const futureRides = rides.filter(ride => new Date(ride.date) >= dayAfterTomorrow);
            document.getElementById('ridesModalTitle').textContent = "🔮 Future Rides";
            displayRides(futureRides);
            document.getElementById('ridesModal').classList.add('open');
            currentFilter = 'all';
            resetFilterTabs();
        }

        function showAddRideModal() {
            showModal('addRideModal');
        }

        function resetFilterTabs() {
            const filterTabs = document.querySelectorAll('.filter-tabs .filter-tab');
            filterTabs.forEach(tab => {
                if (tab.textContent.toLowerCase().includes('all')) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
        }

        // --- Modal Control Functions ---
        function showModal(modalId) {
            document.getElementById(modalId).classList.add('open');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('open');
            if (modalId === 'addRideModal') {
                document.getElementById('addRideForm').reset();
                document.getElementById('photoPreview').style.display = 'none';
                document.getElementById('addRideForm').onsubmit = addRide;
            } else if (modalId === 'editProfileModal') {
                document.getElementById('editProfileForm').reset();
                document.getElementById('profilePhotoPreview').style.display = 'none';
            }
        }

        // --- Driver Profile Management ---
        function showEditProfileModal() {
            document.getElementById('profileName').value = driverProfile.name;
            document.getElementById('profilePhone').value = driverProfile.phone;
            document.getElementById('profileEmail').value = driverProfile.email;
            document.getElementById('profileVehicleMake').value = driverProfile.vehicleMake;
            document.getElementById('profileLicensePlate').value = driverProfile.licensePlate;
            document.getElementById('profileLicenseNumber').value = driverProfile.licenseNumber;
            document.getElementById('profileInsurance').value = driverProfile.insurance;
            document.getElementById('profileEmergencyContact').value = driverProfile.emergencyContact;

            const profilePhotoPreview = document.getElementById('profilePhotoPreview');
            if (driverProfile.photo) {
                profilePhotoPreview.src = driverProfile.photo;
                profilePhotoPreview.style.display = 'block';
            } else {
                profilePhotoPreview.style.display = 'none';
            }

            showModal('editProfileModal');
        }

        function updateDriverProfile(event) {
            event.preventDefault();

            driverProfile.name = document.getElementById('profileName').value;
            driverProfile.phone = document.getElementById('profilePhone').value;
            driverProfile.email = document.getElementById('profileEmail').value;
            driverProfile.vehicleMake = document.getElementById('profileVehicleMake').value;
            driverProfile.licensePlate = document.getElementById('profileLicensePlate').value;
            driverProfile.licenseNumber = document.getElementById('profileLicenseNumber').value;
            driverProfile.insurance = document.getElementById('profileInsurance').value;
            driverProfile.emergencyContact = document.getElementById('profileEmergencyContact').value;

            saveDriverProfile();
            updateDriverProfileDisplay();
            showSuccessMessage('✅ Driver profile updated!');
            closeModal('editProfileModal');
        }

        function handleProfilePhotoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    driverProfile.photo = e.target.result;
                    document.getElementById('profilePhotoPreview').src = e.target.result;
                    document.getElementById('profilePhotoPreview').style.display = 'block';
                    showSuccessMessage('📷 Profile photo selected!');
                };
                reader.readAsDataURL(file);
            }
        }

        function resetToDefaults() {
            showConfirm('Reset Profile?', 'Are you sure you want to reset your driver profile to default values?').then(result => {
                if (result) {
                    driverProfile = {
                        name: 'John Driver',
                        phone: '+1 (555) 123-4567',
                        email: 'john.driver@email.com',
                        vehicleMake: 'Toyota Camry',
                        licensePlate: 'ABC123',
                        licenseNumber: '',
                        insurance: '',
                        emergencyContact: '',
                        photo: null,
                        rating: 4.8
                    };
                    saveDriverProfile();
                    updateDriverProfileDisplay();
                    closeModal('editProfileModal');
                    showAlert('Profile Reset', 'Driver profile reset to defaults.');
                }
            });
        }

        // --- Earnings Reset Functions ---
        function showResetEarningsModal() {
            showModal('resetEarningsModal');
        }

        function resetDisplayOnly() {
            showAlert('Earnings Reset', 'Today\'s earnings display has been reset to $0.00. Your ride data is safe!').then(() => {
                dailyEarningsOffset = calculateTotalEarningsToday();
                localStorage.setItem('ktransport360_earningsOffset', dailyEarningsOffset);
                updateAnalytics();
                closeModal('resetEarningsModal');
            });
        }

        async function resetAllEarnings() {
            const confirmed = await showConfirm('Permanent Reset', 'This will PERMANENTLY erase ALL earnings data and completed rides. Are you absolutely sure?');
            if (confirmed) {
                rides = rides.filter(ride => ride.status !== 'completed');
                customers.forEach(customer => {
                    customer.totalRides = rides.filter(r => r.customerName === customer.name).length;
                    customer.totalSpent = rides.filter(r => r.customerName === customer.name).reduce((sum, r) => sum + r.price, 0);
                    customer.avgRating = customer.totalRides > 0 ? (customer.totalSpent / customer.totalRides / 10) * 5 : 5.0;
                });
                saveRides();
                saveCustomers();
                dailyEarningsOffset = 0;
                localStorage.removeItem('ktransport360_earningsOffset');
                updateAnalytics();
                updateNotificationBadges();
                closeModal('resetEarningsModal');
                showAlert('Earnings Erased', 'All earnings data and completed rides have been permanently erased.');
            }
        }

        // --- Ride Management Functions ---
        function addRide(event) {
            event.preventDefault();
            
            const newRide = {
                id: Date.now(),
                customerName: document.getElementById('customerName').value,
                customerPhone: document.getElementById('customerPhone').value,
                customerEmail: document.getElementById('customerEmail').value,
                pickupLocation: document.getElementById('pickupLocation').value,
                dropoffLocation: document.getElementById('dropoffLocation').value,
                date: document.getElementById('rideDate').value,
                time: document.getElementById('rideTime').value,
                price: parseFloat(document.getElementById('ridePrice').value),
                status: 'scheduled',
                priority: document.getElementById('ridePriority').value,
                notes: document.getElementById('rideNotes').value,
                distance: calculateDistance(),
                duration: calculateDuration()
            };

            rides.push(newRide);
            saveRides();
            
            updateCustomerDatabase(newRide);
            
            updateAnalytics();
            updateNotificationBadges();
            
            closeModal('addRideModal');
            showSuccessMessage('✅ Ride added successfully!');
            
            console.log('New ride added:', newRide);
        }

        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('photoPreview').src = e.target.result;
                    document.getElementById('photoPreview').style.display = 'block';
                    showSuccessMessage('📷 Customer photo selected!');
                };
                reader.readAsDataURL(file);
            }
        }

        function updateCustomerDatabase(ride) {
            let customer = customers.find(c => c.phone === ride.customerPhone);
            
            if (customer) {
                customer.totalRides++;
                customer.totalSpent += ride.price;
                customer.lastRide = ride.date;
                customer.avgRating = ((customer.avgRating * (customer.totalRides - 1)) + 5) / customer.totalRides; 
                if (!customer.preferredLocations.includes(ride.dropoffLocation)) {
                    customer.preferredLocations.push(ride.dropoffLocation);
                }
            } else {
                customer = {
                    id: customers.length + 1,
                    name: ride.customerName,
                    phone: ride.customerPhone,
                    email: ride.customerEmail,
                    totalRides: 1,
                    totalSpent: ride.price,
                    avgRating: 5.0,
                    isVIP: false,
                    lastRide: ride.date,
                    preferredLocations: [ride.dropoffLocation],
                    notes: ''
                };
                customers.push(customer);
            }
            saveCustomers();
        }

        function editRide(rideId) {
            const ride = rides.find(r => r.id === rideId);
            if (!ride) {
                showErrorMessage('Ride not found!');
                return;
            }

            document.getElementById('customerName').value = ride.customerName;
            document.getElementById('customerPhone').value = ride.customerPhone;
            document.getElementById('customerEmail').value = ride.customerEmail || '';
            document.getElementById('pickupLocation').value = ride.pickupLocation;
            document.getElementById('dropoffLocation').value = ride.dropoffLocation;
            document.getElementById('rideDate').value = ride.date;
            document.getElementById('rideTime').value = ride.time;
            document.getElementById('ridePrice').value = ride.price;
            document.getElementById('ridePriority').value = ride.priority;
            document.getElementById('rideNotes').value = ride.notes || '';

            const form = document.getElementById('addRideForm');
            form.onsubmit = function(event) {
                event.preventDefault();
                updateRide(rideId);
            };

            showAddRideModal();
        }

        function updateRide(rideId) {
            const rideIndex = rides.findIndex(r => r.id === rideId);
            if (rideIndex === -1) {
                showErrorMessage('Error: Ride to update not found!');
                return;
            }

            rides[rideIndex] = {
                ...rides[rideIndex],
                customerName: document.getElementById('customerName').value,
                customerPhone: document.getElementById('customerPhone').value,
                customerEmail: document.getElementById('customerEmail').value,
                pickupLocation: document.getElementById('pickupLocation').value,
                dropoffLocation: document.getElementById('dropoffLocation').value,
                date: document.getElementById('rideDate').value,
                time: document.getElementById('rideTime').value,
                price: parseFloat(document.getElementById('ridePrice').value),
                priority: document.getElementById('ridePriority').value,
                notes: document.getElementById('rideNotes').value
            };
            saveRides();

            closeModal('addRideModal');
            showSuccessMessage('✅ Ride updated successfully!');
            
            document.getElementById('addRideForm').onsubmit = addRide;
            
            if (document.getElementById('ridesModal').classList.contains('open')) {
                const title = document.getElementById('ridesModalTitle').textContent;
                if (title.includes('Today')) showTodaysRides();
                else if (title.includes('Tomorrow')) showTomorrowsRides();
                else if (title.includes('Future')) showFutureRides();
            }
            updateAnalytics();
            updateNotificationBadges();
        }

        function startRide(rideId) {
            const ride = rides.find(r => r.id === rideId);
            if (ride) {
                ride.status = 'in-progress';
                saveRides();
                showSuccessMessage(`🚗 Started ride for ${ride.customerName}`);
                updateAnalytics();
                
                if (document.getElementById('ridesModal').classList.contains('open')) {
                    const title = document.getElementById('ridesModalTitle').textContent;
                    if (title.includes('Today')) showTodaysRides();
                    else if (title.includes('Tomorrow')) showTomorrowsRides();
                    else if (title.includes('Future')) showFutureRides();
                }
            } else {
                showErrorMessage('Ride not found!');
            }
        }

        function completeRide(rideId) {
            const ride = rides.find(r => r.id === rideId);
            if (ride) {
                ride.status = 'completed';
                saveRides();
                showSuccessMessage(`✅ Completed ride for ${ride.customerName}`);
                updateAnalytics();
                updateNotificationBadges();
                
                const currentTotalEarnings = calculateTotalEarnings();
                document.getElementById('earningsToday').textContent = `$${(currentTotalEarnings - dailyEarningsOffset).toFixed(2)}`;
                
                if (document.getElementById('ridesModal').classList.contains('open')) {
                    const title = document.getElementById('ridesModalTitle').textContent;
                    if (title.includes('Today')) showTodaysRides();
                    else if (title.includes('Tomorrow')) showTomorrowsRides();
                    else if (title.includes('Future')) showFutureRides();
                }
            } else {
                showErrorMessage('Ride not found!');
            }
        }

        async function cancelRide(rideId) {
            const confirmed = await showConfirm('Cancel Ride?', 'Are you sure you want to cancel this ride? This action cannot be undone.');
            if (confirmed) {
                const ride = rides.find(r => r.id === rideId);
                if (ride) {
                    ride.status = 'cancelled';
                    saveRides();
                    showSuccessMessage(`❌ Cancelled ride for ${ride.customerName}`);
                    updateAnalytics();
                    updateNotificationBadges();
                    
                    if (document.getElementById('ridesModal').classList.contains('open')) {
                        const title = document.getElementById('ridesModalTitle').textContent;
                        if (title.includes('Today')) showTodaysRides();
                        else if (title.includes('Tomorrow')) showTomorrowsRides();
                        else if (title.includes('Future')) showFutureRides();
                    }
                } else {
                    showErrorMessage('Ride not found!');
                }
            }
        }

        function calculateDistance() {
            return `${(Math.random() * 20 + 5).toFixed(1)} miles`;
        }

        function calculateDuration() {
            return `${Math.floor(Math.random() * 30) + 10} minutes`;
        }

        function filterRides() {
            const searchTerm = document.getElementById('ridesSearch').value.toLowerCase();
            const today = new Date().toISOString().split('T')[0];
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowStr = tomorrow.toISOString().split('T')[0];
            const dayAfterTomorrow = new Date();
            dayAfterTomorrow.setDate(new Date().getDate() + 2);

            let ridesToFilter = [];
            const modalTitle = document.getElementById('ridesModalTitle').textContent;

            if (modalTitle.includes('Today')) {
                ridesToFilter = rides.filter(ride => ride.date === today);
            } else if (modalTitle.includes('Tomorrow')) {
                ridesToFilter = rides.filter(ride => ride.date === tomorrowStr);
            } else if (modalTitle.includes('Future')) {
                ridesToFilter = rides.filter(ride => new Date(ride.date) >= dayAfterTomorrow);
            } else {
                ridesToFilter = rides;
            }

            const filteredAndSearchedRides = ridesToFilter.filter(ride => {
                const matchesSearch = ride.customerName.toLowerCase().includes(searchTerm) ||
                                      ride.pickupLocation.toLowerCase().includes(searchTerm) ||
                                      ride.dropoffLocation.toLowerCase().includes(searchTerm) ||
                                      (ride.notes && ride.notes.toLowerCase().includes(searchTerm));
                const matchesStatus = currentFilter === 'all' || ride.status === currentFilter;
                return matchesSearch && matchesStatus;
            });
            displayRides(filteredAndSearchedRides);
        }

        function filterRidesByStatus(status) {
            currentFilter = status;
            const filterTabs = document.querySelectorAll('.filter-tabs .filter-tab');
            filterTabs.forEach(tab => {
                if (tab.textContent.toLowerCase().includes(status)) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            filterRides();
        }

        function displayRides(ridesToShow) {
            const ridesList = document.getElementById('ridesList');
            
            if (ridesToShow.length === 0) {
                ridesList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">🚗</div>
                        <h3>No rides found</h3>
                        <p>No rides scheduled for this period or matching your search.</p>
                    </div>
                `;
                return;
            }

            ridesList.innerHTML = ridesToShow.map(ride => `
                <div class="ride-item priority-${ride.priority}" data-ride-id="${ride.id}">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div style="flex: 1;">
                            <h4>${ride.customerName}</h4>
                            <p>📞 ${ride.customerPhone}</p>
                            <p>📍 ${ride.pickupLocation}</p>
                            <p>🎯 ${ride.dropoffLocation}</p>
                            <p>⏰ ${ride.date} at ${ride.time}</p>
                            <p>💰 $${ride.price.toFixed(2)}</p>
                            ${ride.notes ? `<p>📝 ${ride.notes}</p>` : ''}
                            ${ride.distance ? `<p>📏 ${ride.distance} • ${ride.duration}</p>` : ''}
                        </div>
                        <div style="text-align: right;">
                            <span class="ride-status status-${ride.status}">${ride.status.toUpperCase()}</span>
                            ${ride.priority === 'high' ? '<div style="color: #f44336; font-weight: bold; margin-top: 5px;">🔥 HIGH PRIORITY</div>' : ''}
                        </div>
                    </div>
                    
                    <div class="ride-actions">
                        <button class="btn-small btn-edit" onclick="editRide(${ride.id})">✏️ Edit</button>
                        ${ride.status === 'scheduled' ? `<button class="btn-small btn-complete" onclick="startRide(${ride.id})">🚗 Start</button>` : ''}
                        ${ride.status === 'in-progress' ? `<button class="btn-small btn-complete" onclick="completeRide(${ride.id})">✅ Complete</button>` : ''}
                        <button class="btn-small btn-cancel" onclick="cancelRide(${ride.id})">❌ Cancel</button>
                    </div>
                    
                    <div class="communication-buttons">
                        <button class="comm-btn call" onclick="callCustomer('${ride.customerPhone}')">📞 Call</button>
                        <button class="comm-btn sms" onclick="smsCustomer('${ride.customerPhone}')">💬 SMS</button>
                        <button class="comm-btn whatsapp" onclick="whatsappCustomer('${ride.customerPhone}')">📱 WhatsApp</button>
                        ${ride.customerEmail ? `<button class="comm-btn email" onclick="emailCustomer('${ride.customerEmail}')">✉️ Email</button>` : ''}
                    </div>
                    
                    <div class="map-container">
                        🗺️ Route from ${ride.pickupLocation} to ${ride.dropoffLocation}
                        <div class="distance-badge">${ride.distance || 'Distance TBD'}</div>
                    </div>
                </div>
            `).join('');
        }

        // --- Analytics Functions ---
        function updateAnalytics() {
            const completedRides = rides.filter(ride => ride.status === 'completed');
            const totalEarnings = completedRides.reduce((sum, ride) => sum + ride.price, 0);
            const today = new Date().toISOString().split('T')[0];
            const thisWeekCompletedRides = getThisWeekRides().filter(r => r.status === 'completed');
            const thisMonthCompletedRides = getThisMonthRides().filter(r => r.status === 'completed');

            const totalEarningsToday = calculateTotalEarningsToday();
            document.getElementById('earningsToday').textContent = `$${(totalEarningsToday - dailyEarningsOffset).toFixed(2)}`;

            if (document.getElementById('totalRides')) {
                document.getElementById('totalRides').textContent = completedRides.length;
                document.getElementById('totalEarnings').textContent = `$${totalEarnings.toFixed(2)}`;
                
                const ratedRides = rides.filter(r => r.rating && r.rating > 0);
                const actualAvgRating = ratedRides.length > 0 ? (ratedRides.reduce((sum, r) => sum + r.rating, 0) / ratedRides.length).toFixed(1) : driverProfile.rating;
                document.getElementById('avgRating').textContent = actualAvgRating;
                
                document.getElementById('repeatCustomers').textContent = customers.filter(c => c.totalRides > 1).length;
                document.getElementById('thisWeekRides').textContent = thisWeekCompletedRides.length;
                document.getElementById('avgPrice').textContent = `$${(totalEarnings / Math.max(completedRides.length, 1)).toFixed(2)}`;
                
                document.getElementById('todayRides').textContent = rides.filter(r => r.date === today && r.status === 'completed').length;
                document.getElementById('weeklyEarnings').textContent = `$${thisWeekCompletedRides.reduce((sum, ride) => sum + ride.price, 0).toFixed(2)}`;
                document.getElementById('monthlyRides').textContent = thisMonthCompletedRides.length;
                document.getElementById('customerSatisfaction').textContent = '96%';
            }
        }

        function calculateTotalEarningsToday() {
            const today = new Date().toISOString().split('T')[0];
            const todayCompletedRides = rides.filter(ride => ride.date === today && ride.status === 'completed');
            return todayCompletedRides.reduce((sum, ride) => sum + ride.price, 0);
        }

        function calculateTotalEarnings() {
            const allCompletedRides = rides.filter(ride => ride.status === 'completed');
            return allCompletedRides.reduce((sum, ride) => sum + ride.price, 0);
        }

        function getThisWeekRides() {
            const today = new Date();
            const weekStart = new Date(today.getFullYear(), today.getMonth(), today.getDate() - today.getDay());
            weekStart.setHours(0,0,0,0);

            return rides.filter(ride => {
                const rideDate = new Date(ride.date);
                rideDate.setHours(0,0,0,0);
                return rideDate >= weekStart;
            });
        }

        function getThisMonthRides() {
            const today = new Date();
            const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
            monthStart.setHours(0,0,0,0);

            return rides.filter(ride => {
                const rideDate = new Date(ride.date);
                rideDate.setHours(0,0,0,0);
                return rideDate >= monthStart;
            });
        }

        let performanceChartInstance = null;

        function drawPerformanceChart() {
            const ctx = document.getElementById('performanceChart').getContext('2d');

            if (performanceChartInstance) {
                performanceChartInstance.destroy();
            }

            const last7Days = [];
            const earningsLast7Days = [];
            for (let i = 6; i >= 0; i--) {
                const d = new Date();
                d.setDate(d.getDate() - i);
                const dateStr = d.toISOString().split('T')[0];
                last7Days.push(d.toLocaleDateString('en-US', { weekday: 'short' }));
                
                const dayEarnings = rides.filter(ride => ride.date === dateStr && ride.status === 'completed')
                                     .reduce((sum, ride) => sum + ride.price, 0);
                earningsLast7Days.push(dayEarnings);
            }

            performanceChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: last7Days,
                    datasets: [{
                        label: 'Daily Earnings ($)',
                        data: earningsLast7Days,
                        borderColor: '#667eea',
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        fill: true,
                        tension: 0.3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: 'Daily Earnings',
                            color: isDarkMode ? '#e2e8f0' : '#333'
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                display: false
                            },
                            ticks: {
                                color: isDarkMode ? '#a0aec0' : '#666'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: isDarkMode ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)'
                            },
                            ticks: {
                                color: isDarkMode ? '#a0aec0' : '#666',
                                callback: function(value) {
                                    return '$' + value;
                                }
                            }
                        }
                    }
                }
            });
        }

        function displayTopCustomers() {
            const topCustomersDiv = document.getElementById('topCustomers');
            const sortedCustomers = [...customers].sort((a, b) => b.totalSpent - a.totalSpent);
            
            if (sortedCustomers.length === 0) {
                topCustomersDiv.innerHTML = '<p style="text-align: center; color: #666;">No customer data available yet.</p>';
                return;
            }

            topCustomersDiv.innerHTML = sortedCustomers.slice(0, 5).map(customer => `
                <div class="driver-profile" style="margin-bottom: 10px; padding: 10px; background: #f8f9fa;">
                    <div class="profile-avatar" style="width: 40px; height: 40px; font-size: 18px;">${customer.name.split(' ').map(n => n[0]).join('')}</div>
                    <div class="profile-info">
                        <h4 style="margin-bottom: 2px;">${customer.name}</h4>
                        <p style="font-size: 12px; color: #666;">${customer.totalRides} rides • $${customer.totalSpent.toFixed(2)}</p>
                    </div>
                    <div class="rating-stars" style="margin-left: auto;">⭐ ${customer.avgRating}</div>
                </div>
            `).join('');
        }

        // --- Customer Management Functions ---
        function displayCustomers(customersToShow) {
            const customersGrid = document.getElementById('customersGrid');
            
            if (customersToShow.length === 0) {
                customersGrid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">👥</div>
                        <h3>No customers found</h3>
                        <p>No customers match your search criteria.</p>
                    </div>
                `;
                return;
            }

            customersGrid.innerHTML = customersToShow.map(customer => `
                <div class="customer-card" onclick="showCustomerDetails(${customer.id})">
                    <div class="customer-avatar">${customer.name.split(' ').map(n => n[0]).join('')}</div>
                    <div class="customer-name">${customer.name}</div>
                    <div class="customer-rides">${customer.totalRides} rides • $${customer.totalSpent.toFixed(2)}</div>
                    <div class="rating-stars">⭐ ${customer.avgRating}</div>
                    ${customer.isVIP ? '<div class="badge badge-warning" style="margin-top: 5px;">VIP</div>' : ''}
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        Last ride: ${customer.lastRide}
                    </div>
                </div>
            `).join('');
        }

        function filterCustomers() {
            const searchTerm = document.getElementById('customersSearch').value.toLowerCase();
            let customersToFilter = customers;

            if (currentFilter !== 'all') {
                customersToFilter = customersToFilter.filter(customer => {
                    if (currentFilter === 'repeat') return customer.totalRides > 1;
                    if (currentFilter === 'new') return customer.totalRides === 1;
                    if (currentFilter === 'vip') return customer.isVIP;
                    return true;
                });
            }

            const filteredAndSearchedCustomers = customersToFilter.filter(customer => {
                return customer.name.toLowerCase().includes(searchTerm) ||
                       customer.phone.toLowerCase().includes(searchTerm) ||
                       (customer.email && customer.email.toLowerCase().includes(searchTerm)) ||
                       (customer.notes && customer.notes.toLowerCase().includes(searchTerm));
            });
            displayCustomers(filteredAndSearchedCustomers);
        }

        function filterCustomersByType(type) {
            currentFilter = type;
            const filterTabs = document.querySelectorAll('#customersModal .filter-tabs .filter-tab');
            filterTabs.forEach(tab => {
                if (tab.textContent.toLowerCase().includes(type)) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            filterCustomers();
        }

        function showCustomerDetails(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (!customer) {
                showErrorMessage('Customer details not found!');
                return;
            }

            currentCustomer = customer;
            
            document.getElementById('customerDetailsTitle').textContent = `👤 ${customer.name}`;
            
            const customerRides = rides.filter(ride => ride.customerName === customer.name).sort((a, b) => new Date(b.date) - new Date(a.date));
            
            document.getElementById('customerDetailsContent').innerHTML = `
                <div class="driver-profile" style="box-shadow: none; border: 1px solid #eee;">
                    <div class="profile-avatar">${customer.name.split(' ').map(n => n[0]).join('')}</div>
                    <div class="profile-info">
                        <h3>${customer.name} ${customer.isVIP ? '<span class="badge badge-warning">VIP</span>' : ''}</h3>
                        <p>📞 ${customer.phone}</p>
                        ${customer.email ? `<p>✉️ ${customer.email}</p>` : ''}
                        <div class="rating-stars">⭐ ${customer.avgRating} average rating</div>
                    </div>
                </div>
                
                <div class="analytics-grid" style="margin-top: 15px;">
                    <div class="analytics-card">
                        <div class="analytics-value">${customer.totalRides}</div>
                        <div class="analytics-label">Total Rides</div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-value">$${customer.totalSpent.toFixed(2)}</div>
                        <div class="analytics-label">Total Spent</div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-value">$${customer.totalRides > 0 ? (customer.totalSpent / customer.totalRides).toFixed(2) : '0.00'}</div>
                        <div class="analytics-label">Avg per Ride</div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-value">${customer.avgRating}</div>
                        <div class="analytics-label">Rating</div>
                    </div>
                </div>
                
                ${customer.preferredLocations && customer.preferredLocations.length > 0 ? `
                    <div class="chart-container">
                        <h4>📍 Preferred Locations</h4>
                        ${customer.preferredLocations.map(location => `<span class="badge badge-success" style="margin: 2px;">${location}</span>`).join('')}
                    </div>
                ` : ''}
                
                ${customer.notes ? `
                    <div class="chart-container">
                        <h4>📝 Notes</h4>
                        <p>${customer.notes}</p>
                    </div>
                ` : ''}
            `;

            const rideHistoryHtml = customerRides.map(ride => `
                <div class="timeline-item">
                    <div class="timeline-time">${ride.date} at ${ride.time}</div>
                    <div class="timeline-content">
                        ${ride.pickupLocation} → ${ride.dropoffLocation}
                        <div style="margin-top: 5px;">
                            <span class="ride-status status-${ride.status}">${ride.status}</span>
                            <span style="margin-left: 10px; font-weight: normal;">$${ride.price.toFixed(2)}</span>
                        </div>
                        ${ride.feedback ? `<div style="margin-top: 5px; font-style: italic; color: #666;">"${ride.feedback}"</div>` : ''}
                    </div>
                </div>
            `).join('');

            document.getElementById('customerRideHistory').innerHTML = customerRides.length > 0 ? 
                `<div class="timeline">${rideHistoryHtml}</div>` : 
                '<p style="text-align: center; color: #666;">No ride history available for this customer.</p>';

            showModal('customerDetailsModal');
        }

        // --- Communication Functions ---
        function callCustomer(phone = currentCustomer?.phone) {
            if (phone) {
                window.open(`tel:${phone}`);
                showSuccessMessage(`📞 Calling ${phone}...`);
            } else {
                showErrorMessage('No phone number available to call.');
            }
        }

        function smsCustomer(phone = currentCustomer?.phone) {
            if (phone) {
                window.open(`sms:${phone}`);
                showSuccessMessage(`💬 Opening SMS to ${phone}...`);
            } else {
                showErrorMessage('No phone number available for SMS.');
            }
        }

        function whatsappCustomer(phone = currentCustomer?.phone) {
            if (phone) {
                const cleanPhone = phone.replace(/[^\d]/g, '');
                window.open(`https://wa.me/${cleanPhone}`);
                showSuccessMessage(`📱 Opening WhatsApp to ${phone}...`);
            } else {
                showErrorMessage('No phone number available for WhatsApp.');
            }
        }

        function emailCustomer(email = currentCustomer?.email) {
            if (email) {
                window.open(`mailto:${email}`);
                showSuccessMessage(`✉️ Opening email to ${email}...`);
            } else {
                showErrorMessage('No email address available.');
            }
        }

        // --- Export & Backup Functions ---
        function exportData() {
            showModal('exportModal');
        }

        async function exportToCSV() {
            const confirmed = await showConfirm('Export to CSV', 'This will download all your ride data as a CSV file. Continue?');
            if (!confirmed) return;

            if (rides.length === 0) {
                showAlert('No Data', 'No ride data to export.');
                return;
            }

            const headers = [
                "ID", "Customer Name", "Customer Phone", "Customer Email", "Pickup Location",
                "Dropoff Location", "Date", "Time", "Price", "Status", "Priority", "Notes",
                "Rating", "Feedback", "Distance", "Duration"
            ];
            const csvRows = [
                headers.join(','),
                ...rides.map(ride => {
                    const values = [
                        ride.id,
                        `"${ride.customerName.replace(/"/g, '""')}"`,
                        `"${ride.customerPhone}"`,
                        `"${ride.customerEmail || ''}"`,
                        `"${ride.pickupLocation.replace(/"/g, '""')}"`,
                        `"${ride.dropoffLocation.replace(/"/g, '""')}"`,
                        ride.date,
                        ride.time,
                        ride.price.toFixed(2),
                        ride.status,
                        ride.priority,
                        `"${(ride.notes || '').replace(/"/g, '""')}"`,
                        ride.rating || '',
                        `"${(ride.feedback || '').replace(/"/g, '""')}"`,
                        `"${ride.distance || ''}"`,
                        `"${ride.duration || ''}"`
                    ];
                    return values.join(',');
                })
            ];
            const csvContent = csvRows.join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'ktransport360_rides_data.csv';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showSuccessMessage('📤 Ride data exported to CSV!');
            closeModal('exportModal');
        }

        async function exportToPDF() {
            const confirmed = await showConfirm('Export to PDF', 'This feature requires a PDF generation library. For demonstration, we\'ll simulate a download. Continue?');
            if (!confirmed) return;
            showAlert('PDF Export', 'PDF report simulated. (Requires library like jsPDF to fully function)');
            closeModal('exportModal');
        }

        async function exportCustomers() {
            const confirmed = await showConfirm('Export Customers', 'This will download your customer list as a CSV file. Continue?');
            if (!confirmed) return;

            if (customers.length === 0) {
                showAlert('No Data', 'No customer data to export.');
                return;
            }

            const headers = ["ID", "Name", "Phone", "Email", "Total Rides", "Total Spent", "Average Rating", "VIP Status", "Last Ride Date", "Preferred Locations", "Notes"];
            const csvRows = [
                headers.join(','),
                ...customers.map(customer => {
                    const values = [
                        customer.id,
                        `"${customer.name.replace(/"/g, '""')}"`,
                        `"${customer.phone}"`,
                        `"${customer.email || ''}"`,
                        customer.totalRides,
                        customer.totalSpent.toFixed(2),
                        customer.avgRating,
                        customer.isVIP ? 'Yes' : 'No',
                        customer.lastRide || '',
                        `"${(customer.preferredLocations || []).join('; ').replace(/"/g, '""')}"`,
                        `"${(customer.notes || '').replace(/"/g, '""')}"`
                    ];
                    return values.join(',');
                })
            ];
            const csvContent = csvRows.join('\n');
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'ktransport360_customers_data.csv';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showSuccessMessage('📤 Customer data exported to CSV!');
            closeModal('exportModal');
        }

        async function backupData() {
            const confirmed = await showConfirm('Backup All Data', 'This will create a comprehensive backup file of all your app data (rides, customers, profile) as a JSON file. Continue?');
            if (!confirmed) return;

            const backupData = {
                driverProfile: driverProfile,
                rides: rides,
                customers: customers,
                dailyEarningsOffset: dailyEarningsOffset
            };

            const jsonContent = JSON.stringify(backupData, null, 2);
            const blob = new Blob([jsonContent], { type: 'application/json;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `ktransport360_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            showSuccessMessage('💾 App data backed up successfully!');
            closeModal('exportModal');
        }

        // --- Settings Panel Functions ---
        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            const overlay = document.getElementById('settingsOverlay');
            panel.classList.toggle('open');
            overlay.classList.toggle('open');
        }

        function closeSettings() {
            document.getElementById('settingsPanel').classList.remove('open');
            document.getElementById('settingsOverlay').classList.remove('open');
        }

        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode', isDarkMode);
            localStorage.setItem('darkMode', isDarkMode);
            if (performanceChartInstance) {
                performanceChartInstance.options.plugins.title.color = isDarkMode ? '#e2e8f0' : '#333';
                performanceChartInstance.options.scales.x.ticks.color = isDarkMode ? '#a0aec0' : '#666';
                performanceChartInstance.options.scales.y.grid.color = isDarkMode ? 'rgba(255,255,255,0.1)' : 'rgba(0,0,0,0.1)';
                performanceChartInstance.options.scales.y.ticks.color = isDarkMode ? '#a0aec0' : '#666';
                performanceChartInstance.update();
            }
            event.currentTarget.classList.toggle('active', isDarkMode);
            showSuccessMessage(`Dark Mode ${isDarkMode ? 'enabled' : 'disabled'}.`);
        }

        function toggleNotifications() {
            const toggle = event.currentTarget;
            const isActive = toggle.classList.toggle('active');
            showAlert('Notifications', `Notifications are now ${isActive ? 'ON' : 'OFF'}. (This is a demo feature)`);
        }

        function toggleAutoBackup() {
            const toggle = event.currentTarget;
            const isActive = toggle.classList.toggle('active');
            showAlert('Auto Backup', `Auto Backup is now ${isActive ? 'ON' : 'OFF'}. (This is a demo feature)`);
        }

        function toggleVoiceCommands() {
            const toggle = event.currentTarget;
            const isActive = toggle.classList.toggle('active');
            showAlert('Voice Commands', `Voice Commands are now ${isActive ? 'ON' : 'OFF'}. (Actual voice functionality not implemented in demo)`);
        }

        function toggleGPSTracking() {
            const toggle = event.currentTarget;
            const isActive = toggle.classList.toggle('active');
            showAlert('GPS Tracking', `GPS Tracking is now ${isActive ? 'ON' : 'OFF'}. (This is a demo feature)`);
        }

        async function resetAppData() {
            const confirmed = await showConfirm('Reset All App Data', 'This will permanently delete ALL your rides, customers, profile, and earnings data. This cannot be undone. Are you sure?');
            if (confirmed) {
                rides = [];
                customers = [];
                dailyEarningsOffset = 0;
                localStorage.clear();
                driverProfile = {
                    name: 'John Driver',
                    phone: '+1 (555) 123-4567',
                    email: 'john.driver@email.com',
                    vehicleMake: 'Toyota Camry',
                    licensePlate: 'ABC123',
                    licenseNumber: '',
                    insurance: '',
                    emergencyContact: '',
                    photo: null,
                    rating: 4.8
                };
                initializeApp();
                updateAnalytics();
                updateNotificationBadges();
                showAlert('App Data Reset', 'All app data has been reset to default.');
                closeSettings();
            }
        }

        // --- Other Functions ---
        function checkOfflineStatus() {
            const offlineBanner = document.getElementById('offlineBanner');
            const isOnline = navigator.onLine;
            if (!isOnline) {
                offlineBanner.style.display = 'block';
            } else {
                offlineBanner.style.display = 'none';
            }
            console.log(`App is ${isOnline ? 'online' : 'offline'}.`);
        }





      function triggerEmergency() {
    // Create custom emergency modal
    const emergencyModal = document.createElement('div');
    emergencyModal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.8);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 10000;
        font-family: Arial, sans-serif;
    `;
    
    emergencyModal.innerHTML = `
        <div style="background: white; padding: 30px; border-radius: 15px; text-align: center; max-width: 300px; margin: 20px;">
            <h2 style="color: #f44336; margin: 0 0 20px 0;">🚨 EMERGENCY</h2>
            <p style="margin-bottom: 30px; font-size: 16px;">Choose emergency type:</p>
            
            <button onclick="call911()" style="
                width: 100%; 
                padding: 15px; 
                margin: 10px 0; 
                background: #f44336; 
                color: white; 
                border: none; 
                border-radius: 8px; 
                font-size: 16px; 
                font-weight: bold;
                cursor: pointer;
            ">🚨 CALL 911 - LIFE THREATENING</button>
            
            <button onclick="callCompany()" style="
                width: 100%; 
                padding: 15px; 
                margin: 10px 0; 
                background: #ff9800; 
                color: white; 
                border: none; 
                border-radius: 8px; 
                font-size: 16px; 
                font-weight: bold;
                cursor: pointer;
            ">📞 CALL COMPANY - VEHICLE/WORK ISSUE</button>
            
            <button onclick="closeEmergencyModal()" style="
                width: 100%; 
                padding: 15px; 
                margin: 10px 0; 
                background: #666; 
                color: white; 
                border: none; 
                border-radius: 8px; 
                font-size: 16px;
                cursor: pointer;
            ">❌ CANCEL</button>
        </div>
    `;
    
    document.body.appendChild(emergencyModal);
    
    // Add global functions for the buttons
    window.call911 = function() {
        closeEmergencyModal();
        window.location.href = 'tel:911';
    };
    
    window.callCompany = function() {
        closeEmergencyModal();
        window.location.href = 'tel:5597074669';
    };
    
    window.closeEmergencyModal = function() {
        document.body.removeChild(emergencyModal);
    };
}






        function toggleVoiceCommand() {
            isVoiceListening = !isVoiceListening;
            const voiceBtn = document.getElementById('voiceBtn');
            if (isVoiceListening) {
                voiceBtn.classList.add('listening');
                showAlert('🎤 Voice Command', 'Listening for commands... Say "Add Ride", "Show Today\'s Rides", etc.');
            } else {
                voiceBtn.classList.remove('listening');
                showAlert('🎤 Voice Command', 'Voice command listening stopped.');
            }
        }
    </script>
</body>
</html>
