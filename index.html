<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KTransport360 Driver</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 420px;
            margin: 0 auto;
            background: white;
            min-height: 100vh;
            position: relative;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 24px;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .header .subtitle {
            font-size: 14px;
            opacity: 0.9;
        }

        .truck-icon {
            font-size: 28px;
        }

        .status-badge {
            background: #4CAF50;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            margin: 15px 0;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .status-badge::before {
            content: "📱";
        }

        .main-content {
            padding: 20px;
        }

        .ride-cards {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .ride-card {
            padding: 20px;
            border-radius: 12px;
            color: white;
            text-align: center;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            overflow: hidden;
        }

        .ride-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .ride-card.today {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .ride-card.tomorrow {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .ride-card.future {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .ride-card.analytics {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            color: #333;
        }

        .ride-card-icon {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }

        .ride-card h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .ride-card p {
            font-size: 14px;
            opacity: 0.9;
        }

        .action-buttons {
            display: grid;
            gap: 15px;
            margin-top: 20px;
        }

        .btn {
            padding: 16px 20px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            text-decoration: none;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            max-width: 420px;
            width: 100%;
            background: white;
            border-top: 1px solid #eee;
            padding: 10px 0;
            display: flex;
            justify-content: space-around;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 8px 12px;
            cursor: pointer;
            color: #666;
            transition: color 0.2s;
            text-decoration: none;
            font-size: 12px;
        }

        .nav-item:hover,
        .nav-item.active {
            color: #667eea;
        }

        .nav-item-icon {
            font-size: 18px;
            margin-bottom: 4px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 12px;
            width: 90%;
            max-width: 500px;
            max-height: 80vh;
            overflow-y: auto;
            position: relative;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            position: absolute;
            right: 15px;
            top: 10px;
        }

        .close:hover {
            color: #000;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #eee;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .ride-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .ride-item {
            background: #f8f9fa;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }

        .ride-item h4 {
            color: #333;
            margin-bottom: 5px;
        }

        .ride-item p {
            color: #666;
            font-size: 14px;
            margin-bottom: 3px;
        }

        .ride-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }

        .btn-small {
            padding: 8px 12px;
            font-size: 12px;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-edit {
            background: #ffc107;
            color: #333;
        }

        .btn-complete {
            background: #28a745;
            color: white;
        }

        .btn-cancel {
            background: #dc3545;
            color: white;
        }

        .customer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .customer-card {
            background: white;
            border: 2px solid #eee;
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .customer-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .customer-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: #667eea;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        .customer-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .customer-rides {
            font-size: 12px;
            color: #666;
        }

        .analytics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .analytics-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #eee;
        }

        .analytics-value {
            font-size: 32px;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .analytics-label {
            font-size: 14px;
            color: #666;
        }

        .chart-container {
            margin-top: 20px;
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 2px solid #eee;
        }

        .communication-buttons {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 15px;
        }

        .comm-btn {
            padding: 10px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 5px;
            transition: all 0.2s;
        }

        .comm-btn.call {
            background: #28a745;
            color: white;
        }

        .comm-btn.sms {
            background: #007bff;
            color: white;
        }

        .comm-btn.whatsapp {
            background: #25d366;
            color: white;
        }

        .comm-btn.email {
            background: #6c757d;
            color: white;
        }

        .comm-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }

        .photo-upload {
            text-align: center;
            padding: 20px;
            border: 2px dashed #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .photo-upload:hover {
            border-color: #667eea;
            background: #f8f9ff;
        }

        .photo-preview {
            max-width: 100px;
            max-height: 100px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .hidden {
            display: none !important;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #c3e6cb;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #f5c6cb;
        }

        .badge {
            display: inline-block;
            padding: 4px 8px;
            font-size: 12px;
            border-radius: 12px;
            font-weight: 600;
        }

        .badge-success {
            background: #d4edda;
            color: #155724;
        }

        .badge-warning {
            background: #fff3cd;
            color: #856404;
        }

        .badge-danger {
            background: #f8d7da;
            color: #721c24;
        }

        .floating-add {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.2s;
            z-index: 100;
        }

        .floating-add:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        @media (max-width: 480px) {
            .ride-cards {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                margin: 10% auto;
                width: 95%;
            }
            
            .customer-grid {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
        }

        .stats-overview {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .stats-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .stats-row:last-child {
            margin-bottom: 0;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 24px;
            font-weight: bold;
            display: block;
        }

        .stat-label {
            font-size: 12px;
            opacity: 0.9;
        }

        .export-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .export-card {
            background: white;
            border: 2px solid #eee;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .export-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
        }

        .export-icon {
            font-size: 32px;
            margin-bottom: 10px;
            color: #667eea;
        }

        .search-bar {
            position: relative;
            margin-bottom: 20px;
        }

        .search-input {
            width: 100%;
            padding: 12px 40px 12px 15px;
            border: 2px solid #eee;
            border-radius: 25px;
            font-size: 16px;
            transition: border-color 0.2s;
        }

        .search-input:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #666;
        }

        .filter-tabs {
            display: flex;
            background: #f8f9fa;
            border-radius: 25px;
            padding: 4px;
            margin-bottom: 20px;
        }

        .filter-tab {
            flex: 1;
            padding: 10px 15px;
            text-align: center;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
            font-weight: 600;
        }

        .filter-tab.active {
            background: #667eea;
            color: white;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .quick-actions {
            position: fixed;
            bottom: 150px;
            right: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            z-index: 99;
        }

        .quick-action {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            color: white;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            transition: all 0.2s;
        }

        .quick-action.customers {
            background: #28a745;
        }

        .quick-action.analytics {
            background: #ffc107;
            color: #333;
        }

        .quick-action:hover {
            transform: scale(1.1);
        }

        .timeline {
            position: relative;
            padding-left: 30px;
            margin-top: 20px;
        }

        .timeline::before {
            content: '';
            position: absolute;
            left: 15px;
            top: 0;
            bottom: 0;
            width: 2px;
            background: #eee;
        }

        .timeline-item {
            position: relative;
            margin-bottom: 20px;
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .timeline-item::before {
            content: '';
            position: absolute;
            left: -22px;
            top: 20px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #667eea;
        }

        .timeline-time {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .timeline-content {
            font-weight: 600;
            color: #333;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #eee;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.3s ease;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .ride-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-scheduled {
            background: #e3f2fd;
            color: #1976d2;
        }

        .status-in-progress {
            background: #fff3e0;
            color: #f57c00;
        }

        .status-completed {
            background: #e8f5e8;
            color: #388e3c;
        }

        .status-cancelled {
            background: #ffebee;
            color: #d32f2f;
        }

        .weather-widget {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
        }

        .weather-temp {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .weather-desc {
            font-size: 14px;
            opacity: 0.9;
        }

        .earnings-summary {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        .earnings-today {
            font-size: 28px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .earnings-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .priority-high {
            border-left-color: #dc3545 !important;
        }

        .priority-medium {
            border-left-color: #ffc107 !important;
        }

        .priority-low {
            border-left-color: #28a745 !important;
        }

        .rating-stars {
            color: #ffc107;
            font-size: 16px;
            margin: 5px 0;
        }

        .feedback-section {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .feedback-item {
            background: white;
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 10px;
            border-left: 3px solid #667eea;
        }

        .swipe-actions {
            position: relative;
            overflow: hidden;
        }

        .swipe-content {
            transition: transform 0.3s ease;
        }

        .swipe-actions-right {
            position: absolute;
            right: 0;
            top: 0;
            height: 100%;
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 0 15px;
        }

        .map-container {
            height: 200px;
            background: #f0f0f0;
            border-radius: 8px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            font-size: 14px;
        }

        .distance-badge {
            background: #e3f2fd;
            color: #1976d2;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 10px;
        }

        .fuel-tracker {
            background: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .fuel-level {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }

        .fuel-bar {
            flex: 1;
            height: 8px;
            background: #eeeeee;
            border-radius: 4px;
            overflow: hidden;
        }

        .fuel-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #feca57, #48dbfb);
            transition: width 0.3s ease;
        }

        .maintenance-alerts {
            background: #ffebee;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
            font-size: 14px;
        }

        .alert-icon {
            color: #f44336;
            font-size: 16px;
        }

        .driver-profile {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: white;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .profile-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            font-weight: bold;
        }

        .profile-info h3 {
            margin-bottom: 5px;
            color: #333;
        }

        .profile-info p {
            color: #666;
            font-size: 14px;
            margin-bottom: 3px;
        }

        .backup-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 15px;
            background: #e8f5e8;
            color: #2e7d32;
            border-radius: 8px;
            font-size: 14px;
            margin-bottom: 20px;
        }

        .sync-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #4caf50;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .emergency-button {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: #f44336;
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(244, 67, 54, 0.3);
            z-index: 1000;
            transition: all 0.2s;
        }

        .emergency-button:hover {
            transform: scale(1.1);
            background: #d32f2f;
        }

        .dark-mode {
            background: #1a1a1a;
            color: #ffffff;
        }

        .dark-mode .container {
            background: #2d2d2d;
        }

        .dark-mode .modal-content {
            background: #3d3d3d;
            color: #ffffff;
        }

        .dark-mode .form-group input,
        .dark-mode .form-group select,
        .dark-mode .form-group textarea {
            background: #4d4d4d;
            border-color: #555;
            color: #ffffff;
        }

        .dark-mode .ride-item {
            background: #3d3d3d;
            color: #ffffff;
        }

        .settings-panel {
            position: fixed;
            top: 0;
            right: -300px;
            width: 300px;
            height: 100vh;
            background: white;
            box-shadow: -2px 0 10px rgba(0,0,0,0.1);
            transition: right 0.3s ease;
            z-index: 1001;
            padding: 20px;
            overflow-y: auto;
        }

        .settings-panel.open {
            right: 0;
        }

        .settings-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }

        .toggle-switch {
            position: relative;
            width: 50px;
            height: 25px;
            background: #ccc;
            border-radius: 25px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active {
            background: #667eea;
        }

        .toggle-knob {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 21px;
            height: 21px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .toggle-switch.active .toggle-knob {
            transform: translateX(25px);
        }

        .offline-banner {
            background: #ff9800;
            color: white;
            padding: 10px;
            text-align: center;
            font-size: 14px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1002;
            display: none;
        }

        .voice-command-btn {
            position: fixed;
            bottom: 150px;
            left: 20px;
            width: 50px;
            height: 50px;
            background: #9c27b0;
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(156, 39, 176, 0.3);
            z-index: 100;
            transition: all 0.2s;
        }

        .voice-command-btn:hover {
            transform: scale(1.1);
        }

        .voice-command-btn.listening {
            background: #e91e63;
            animation: pulse 1s infinite;
        }

        .route-optimization {
            background: #e1f5fe;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }

        .route-suggestion {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .route-info {
            flex: 1;
        }

        .route-time {
            font-weight: bold;
            color: #0277bd;
        }

        .route-distance {
            font-size: 12px;
            color: #666;
        }

        .accept-route-btn {
            background: #4caf50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="offline-banner" id="offlineBanner">
        📡 You're offline. Data will sync when connection is restored.
    </div>

    <div class="container">
        <!-- Emergency Button -->
        <button class="emergency-button" onclick="triggerEmergency()" title="Emergency">
            🚨
        </button>

        <!-- Header -->
        <div class="header">
            <h1>
                <span class="truck-icon">🚛</span>
                KTransport360 Driver
            </h1>
            <p class="subtitle">Simple & Reliable Transport Management</p>
            <div class="status-badge">
                App Ready - All data saved on your phone
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Driver Profile -->
            <div class="driver-profile">
                <div class="profile-avatar" id="driverAvatar">JD</div>
                <div class="profile-info">
                    <h3 id="driverName">John Driver</h3>
                    <p id="driverPhone">📞 +1 (555) 123-4567</p>
                    <p id="driverVehicle">🚗 Toyota Camry - ABC123</p>
                    <div class="rating-stars" id="driverRating">
                        ⭐⭐⭐⭐⭐ 4.8
                    </div>
                </div>
            </div>

            <!-- Backup Status -->
            <div class="backup-status">
                <div class="sync-indicator"></div>
                <span>All data synced and backed up locally</span>
            </div>

            <!-- Weather Widget -->
            <div class="weather-widget" id="weatherWidget">
                <div class="weather-temp">75°F</div>
                <div class="weather-desc">⛅ Partly Cloudy - Perfect driving weather</div>
            </div>

            <!-- Earnings Summary -->
            <div class="earnings-summary">
                <div class="earnings-today" id="earningsToday">$127.50</div>
                <div class="earnings-label">Today's Earnings</div>
            </div>

            <!-- Fuel Tracker -->
            <div class="fuel-tracker">
                <div class="fuel-level">
                    <span>⛽ Fuel Level:</span>
                    <div class="fuel-bar">
                        <div class="fuel-fill" style="width: 75%"></div>
                    </div>
                    <span>75%</span>
                </div>
                <p style="font-size: 12px; color: #666;">~200 miles remaining</p>
            </div>

            <!-- Maintenance Alerts -->
            <div class="maintenance-alerts" id="maintenanceAlerts">
                <h4>🔧 Maintenance Reminders</h4>
                <div class="alert-item">
                    <span class="alert-icon">⚠️</span>
                    <span>Oil change due in 500 miles</span>
                </div>
                <div class="alert-item">
                    <span class="alert-icon">🔍</span>
                    <span>Inspection due next month</span>
                </div>
            </div>

            <!-- Route Optimization -->
            <div class="route-optimization" id="routeOptimization">
                <h4>🗺️ Optimal Route Suggestion</h4>
                <div class="route-suggestion">
                    <div class="route-info">
                        <div class="route-time">25 min route</div>
                        <div class="route-distance">12.3 miles via I-95</div>
                    </div>
                    <button class="accept-route-btn" onclick="acceptRoute()">Accept</button>
                </div>
            </div>

            <!-- Ride Cards -->
            <div class="ride-cards">
                <div class="ride-card today" onclick="showTodaysRides()">
                    <span class="ride-card-icon">📅</span>
                    <h3>TODAY'S</h3>
                    <p>RIDES</p>
                    <div class="notification-badge" id="todaysBadge">3</div>
                </div>
                <div class="ride-card tomorrow" onclick="showTomorrowsRides()">
                    <span class="ride-card-icon">📆</span>
                    <h3>TOMORROW'S</h3>
                    <p>RIDES</p>
                    <div class="notification-badge" id="tomorrowsBadge">5</div>
                </div>
                <div class="ride-card future" onclick="showFutureRides()">
                    <span class="ride-card-icon">🔮</span>
                    <h3>FUTURE</h3>
                    <p>RIDES</p>
                </div>
                <div class="ride-card analytics" onclick="showAnalytics()">
                    <span class="ride-card-icon">📊</span>
                    <h3>ANALYTICS</h3>
                    <p>& INSIGHTS</p>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="showAddRideModal()">
                    ➕ Add New Ride
                </button>
                <button class="btn btn-secondary" onclick="exportData()">
                    📤 Export Data for Spreadsheet
                </button>
            </div>
        </div>

        <!-- Floating Action Buttons -->
        <div class="quick-actions">
            <button class="quick-action customers" onclick="showCustomers()" title="Customers">
                👥
            </button>
            <button class="quick-action analytics" onclick="showAnalytics()" title="Analytics">
                📊
            </button>
        </div>

        <!-- Voice Command Button -->
        <button class="voice-command-btn" id="voiceBtn" onclick="toggleVoiceCommand()" title="Voice Command">
            🎤
        </button>

        <!-- Floating Add Button -->
        <button class="floating-add" onclick="showAddRideModal()" title="Add New Ride">
            ➕
        </button>

        <!-- Bottom Navigation -->
        <div class="bottom-nav">
            <a href="#" class="nav-item active" onclick="showHome()">
                <span class="nav-item-icon">🏠</span>
                <span>Home</span>
            </a>
            <a href="#" class="nav-item" onclick="showToday()">
                <span class="nav-item-icon">📅</span>
                <span>Today</span>
            </a>
            <a href="#" class="nav-item" onclick="showTomorrow()">
                <span class="nav-item-icon">📆</span>
                <span>Tomorrow</span>
            </a>
            <a href="#" class="nav-item" onclick="showFuture()">
                <span class="nav-item-icon">🔮</span>
                <span>Future</span>
            </a>
            <a href="#" class="nav-item" onclick="showAnalytics()">
                <span class="nav-item-icon">📊</span>
                <span>Analytics</span>
            </a>
            <a href="#" class="nav-item" onclick="showCustomers()">
                <span class="nav-item-icon">👥</span>
                <span>Customers</span>
            </a>
        </div>
    </div>

    <!-- Add Ride Modal -->
    <div id="addRideModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('addRideModal')">&times;</span>
            <h2>➕ Add New Ride</h2>
            <form id="addRideForm" onsubmit="addRide(event)">
                <div class="form-group">
                    <label for="customerName">Customer Name:</label>
                    <input type="text" id="customerName" required>
                </div>
                <div class="form-group">
                    <label for="customerPhone">Phone Number:</label>
                    <input type="tel" id="customerPhone" required>
                </div>
                <div class="form-group">
                    <label for="customerEmail">Email (Optional):</label>
                    <input type="email" id="customerEmail">
                </div>
                <div class="form-group">
                    <label for="pickupLocation">Pickup Location:</label>
                    <input type="text" id="pickupLocation" required>
                </div>
                <div class="form-group">
                    <label for="dropoffLocation">Drop-off Location:</label>
                    <input type="text" id="dropoffLocation" required>
                </div>
                <div class="form-group">
                    <label for="rideDate">Date:</label>
                    <input type="date" id="rideDate" required>
                </div>
                <div class="form-group">
                    <label for="rideTime">Time:</label>
                    <input type="time" id="rideTime" required>
                </div>
                <div class="form-group">
                    <label for="ridePrice">Price ($):</label>
                    <input type="number" id="ridePrice" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="ridePriority">Priority:</label>
                    <select id="ridePriority">
                        <option value="low">Low</option>
                        <option value="medium" selected>Medium</option>
                        <option value="high">High</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="rideNotes">Notes (Optional):</label>
                    <textarea id="rideNotes" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="customerPhoto">Customer Photo (Optional):</label>
                    <div class="photo-upload" onclick="document.getElementById('customerPhotoInput').click()">
                        <input type="file" id="customerPhotoInput" accept="image/*" style="display: none;" onchange="handlePhotoUpload(event)">
                        <p>📷 Tap to add customer photo</p>
                        <img id="photoPreview" class="photo-preview" style="display: none;">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary" style="width: 100%; margin-top: 20px;">
                    ✅ Add Ride
                </button>
            </form>
        </div>
    </div>

    <!-- Rides Modal -->
    <div id="ridesModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('ridesModal')">&times;</span>
            <h2 id="ridesModalTitle">📅 Rides</h2>
            
            <!-- Search Bar -->
            <div class="search-bar">
                <input type="text" class="search-input" id="ridesSearch" placeholder="Search rides..." onkeyup="filterRides()">
                <span class="search-icon">🔍</span>
            </div>

            <!-- Filter Tabs -->
            <div class="filter-tabs">
                <div class="filter-tab active" onclick="filterRidesByStatus('all')">All</div>
                <div class="filter-tab" onclick="filterRidesByStatus('scheduled')">Scheduled</div>
                <div class="filter-tab" onclick="filterRidesByStatus('in-progress')">In Progress</div>
                <div class="filter-tab" onclick="filterRidesByStatus('completed')">Completed</div>
            </div>

            <div class="ride-list" id="ridesList">
                <!-- Rides will be populated here -->
            </div>
        </div>
    </div>

    <!-- Analytics Modal -->
    <div id="analyticsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('analyticsModal')">&times;</span>
            <h2>📊 Analytics & Insights</h2>
            
            <!-- Stats Overview -->
            <div class="stats-overview">
                <div class="stats-row">
                    <div class="stat-item">
                        <span class="stat-value" id="totalRides">127</span>
                        <span class="stat-label">Total Rides</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="totalEarnings">$3,240</span>
                        <span class="stat-label">Total Earnings</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="avgRating">4.8</span>
                        <span class="stat-label">Avg Rating</span>
                    </div>
                </div>
                <div class="stats-row">
                    <div class="stat-item">
                        <span class="stat-value" id="repeatCustomers">34</span>
                        <span class="stat-label">Repeat Customers</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="thisWeekRides">23</span>
                        <span class="stat-label">This Week</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-value" id="avgPrice">$25.50</span>
                        <span class="stat-label">Avg Price</span>
                    </div>
                </div>
            </div>

            <!-- Analytics Cards -->
            <div class="analytics-grid">
                <div class="analytics-card">
                    <div class="analytics-value" id="todayRides">8</div>
                    <div class="analytics-label">Today's Rides</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-value" id="weeklyEarnings">$680</div>
                    <div class="analytics-label">This Week</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-value" id="monthlyRides">89</div>
                    <div class="analytics-label">This Month</div>
                </div>
                <div class="analytics-card">
                    <div class="analytics-value" id="customerSatisfaction">96%</div>
                    <div class="analytics-label">Satisfaction</div>
                </div>
            </div>

            <!-- Chart Container -->
            <div class="chart-container">
                <h3>📈 Weekly Performance</h3>
                <canvas id="performanceChart" width="400" height="200"></canvas>
            </div>

            <!-- Top Customers -->
            <div class="chart-container">
                <h3>⭐ Top Customers This Month</h3>
                <div id="topCustomers">
                    <!-- Will be populated by JavaScript -->
                </div>
            </div>

            <!-- Recent Feedback -->
            <div class="feedback-section">
                <h3>💬 Recent Customer Feedback</h3>
                <div class="feedback-item">
                    <div class="rating-stars">⭐⭐⭐⭐⭐</div>
                    <p>"Excellent service! Very punctual and professional." - Sarah M.</p>
                </div>
                <div class="feedback-item">
                    <div class="rating-stars">⭐⭐⭐⭐⭐</div>
                    <p>"Clean vehicle and safe driving. Highly recommend!" - Mike R.</p>
                </div>
                <div class="feedback-item">
                    <div class="rating-stars">⭐⭐⭐⭐⭐</div>
                    <p>"Always on time and very friendly driver." - Jennifer L.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Customers Modal -->
    <div id="customersModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('customersModal')">&times;</span>
            <h2>👥 Customer Management</h2>
            
            <!-- Search Bar -->
            <div class="search-bar">
                <input type="text" class="search-input" id="customersSearch" placeholder="Search customers..." onkeyup="filterCustomers()">
                <span class="search-icon">🔍</span>
            </div>

            <!-- Filter Tabs -->
            <div class="filter-tabs">
                <div class="filter-tab active" onclick="filterCustomersByType('all')">All</div>
                <div class="filter-tab" onclick="filterCustomersByType('repeat')">Repeat</div>
                <div class="filter-tab" onclick="filterCustomersByType('new')">New</div>
                <div class="filter-tab" onclick="filterCustomersByType('vip')">VIP</div>
            </div>

            <div class="customer-grid" id="customersGrid">
                <!-- Customers will be populated here -->
            </div>
        </div>
    </div>

    <!-- Customer Details Modal -->
    <div id="customerDetailsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('customerDetailsModal')">&times;</span>
            <h2 id="customerDetailsTitle">👤 Customer Details</h2>
            
            <div id="customerDetailsContent">
                <!-- Customer details will be populated here -->
            </div>

            <!-- Communication Buttons -->
            <div class="communication-buttons">
                <button class="comm-btn call" onclick="callCustomer()">
                    📞 Call
                </button>
                <button class="comm-btn sms" onclick="smsCustomer()">
                    💬 SMS
                </button>
                <button class="comm-btn whatsapp" onclick="whatsappCustomer()">
                    📱 WhatsApp
                </button>
                <button class="comm-btn email" onclick="emailCustomer()">
                    ✉️ Email
                </button>
            </div>

            <!-- Ride History -->
            <div class="chart-container">
                <h3>🚗 Ride History</h3>
                <div id="customerRideHistory">
                    <!-- Ride history will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal('exportModal')">&times;</span>
            <h2>📤 Export Data</h2>
            
            <div class="export-options">
                <div class="export-card" onclick="exportToCSV()">
                    <div class="export-icon">📊</div>
                    <h3>CSV Spreadsheet</h3>
                    <p>Export all ride data to CSV format for Excel or Google Sheets</p>
                </div>
                <div class="export-card" onclick="exportToPDF()">
                    <div class="export-icon">📄</div>
                    <h3>PDF Report</h3>
                    <p>Generate a comprehensive PDF report with analytics</p>
                </div>
                <div class="export-card" onclick="exportCustomers()">
                    <div class="export-icon">👥</div>
                    <h3>Customer List</h3>
                    <p>Export customer database with contact information</p>
                </div>
                <div class="export-card" onclick="backupData()">
                    <div class="export-icon">💾</div>
                    <h3>Backup Data</h3>
                    <p>Create a complete backup of all your data</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Panel -->
    <div id="settingsPanel" class="settings-panel">
        <h2>⚙️ Settings</h2>
        
        <div class="settings-item">
            <span>Dark Mode</span>
            <div class="toggle-switch" onclick="toggleDarkMode()">
                <div class="toggle-knob"></div>
            </div>
        </div>
        
        <div class="settings-item">
            <span>Notifications</span>
            <div class="toggle-switch active" onclick="toggleNotifications()">
                <div class="toggle-knob"></div>
            </div>
        </div>
        
        <div class="settings-item">
            <span>Auto Backup</span>
            <div class="toggle-switch active" onclick="toggleAutoBackup()">
                <div class="toggle-knob"></div>
            </div>
        </div>
        
        <div class="settings-item">
            <span>Voice Commands</span>
            <div class="toggle-switch" onclick="toggleVoiceCommands()">
                <div class="toggle-knob"></div>
            </div>
        </div>
        
        <div class="settings-item">
            <span>GPS Tracking</span>
            <div class="toggle-switch active" onclick="toggleGPSTracking()">
                <div class="toggle-knob"></div>
            </div>
        </div>
        
        <button class="btn btn-secondary" onclick="resetAppData()" style="width: 100%; margin-top: 20px;">
            🔄 Reset App Data
        </button>
    </div>

    <script>
        // Global variables
        let rides = [];
        let customers = [];
        let analytics = {};
        let currentCustomer = null;
        let isVoiceListening = false;
        let currentFilter = 'all';
        let isDarkMode = false;

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
            loadSampleData();
            updateAnalytics();
            setTodaysDate();
            checkOfflineStatus();
            updateWeather();
        });

        // Initialize app with sample data and settings
        function initializeApp() {
            console.log('KTransport360 Driver App initialized successfully!');
            
            // Load settings from localStorage
            isDarkMode = localStorage.getItem('darkMode') === 'true';
            if (isDarkMode) {
                document.body.classList.add('dark-mode');
            }

            // Set default date to today
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('rideDate').value = today;

            // Initialize notification badges
            updateNotificationBadges();
        }

        // Load sample data for demonstration
        function loadSampleData() {
            rides = [
                {
                    id: 1,
                    customerName: 'Sarah Johnson',
                    customerPhone: '+1 (555) 123-4567',
                    customerEmail: 'sarah.j@email.com',
                    pickupLocation: '123 Main St, Downtown',
                    dropoffLocation: 'Airport Terminal A',
                    date: '2025-06-11',
                    time: '14:30',
                    price: 45.00,
                    status: 'scheduled',
                    priority: 'high',
                    notes: 'Flight at 6 PM - needs to be on time',
                    rating: 5,
                    feedback: 'Excellent service!',
                    distance: '12.5 miles',
                    duration: '25 minutes'
                },
                {
                    id: 2,
                    customerName: 'Mike Rodriguez',
                    customerPhone: '+1 (555) 987-6543',
                    customerEmail: 'mike.r@email.com',
                    pickupLocation: '456 Oak Avenue, Suburbs',
                    dropoffLocation: 'City Medical Center',
                    date: '2025-06-11',
                    time: '16:00',
                    price: 28.50,
                    status: 'scheduled',
                    priority: 'medium',
                    notes: 'Doctor appointment - patient has mobility issues',
                    rating: 5,
                    feedback: 'Very helpful and patient driver',
                    distance: '8.2 miles',
                    duration: '18 minutes'
                },
                {
                    id: 3,
                    customerName: 'Jennifer Lee',
                    customerPhone: '+1 (555) 555-0123',
                    customerEmail: 'jenny.lee@email.com',
                    pickupLocation: '789 Pine Street, Midtown',
                    dropoffLocation: 'Shopping Mall Plaza',
                    date: '2025-06-11',
                    time: '18:45',
                    price: 22.00,
                    status: 'scheduled',
                    priority: 'low',
                    notes: 'Shopping trip - multiple stops possible',
                    rating: 4,
                    feedback: 'Good service, clean vehicle',
                    distance: '6.7 miles',
                    duration: '15 minutes'
                },
                {
                    id: 4,
                    customerName: 'Robert Chen',
                    customerPhone: '+1 (555) 444-7890',
                    customerEmail: 'robert.c@email.com',
                    pickupLocation: 'Business District Plaza',
                    dropoffLocation: '321 Elm Street, Residential',
                    date: '2025-06-12',
                    time: '09:15',
                    price: 35.00,
                    status: 'scheduled',
                    priority: 'medium',
                    notes: 'Business meeting pickup - formal attire',
                    rating: 5,
                    feedback: 'Professional and punctual',
                    distance: '10.3 miles',
                    duration: '22 minutes'
                },
                {
                    id: 5,
                    customerName: 'Emily Davis',
                    customerPhone: '+1 (555) 321-0987',
                    customerEmail: 'emily.d@email.com',
                    pickupLocation: 'University Campus, Building A',
                    dropoffLocation: 'Train Station Central',
                    date: '2025-06-12',
                    time: '11:30',
                    price: 18.50,
                    status: 'scheduled',
                    priority: 'low',
                    notes: 'Student - heading home for weekend',
                    rating: 5,
                    feedback: 'Friendly driver, good music',
                    distance: '5.1 miles',
                    duration: '12 minutes'
                }
            ];

            customers = [
                {
                    id: 1,
                    name: 'Sarah Johnson',
                    phone: '+1 (555) 123-4567',
                    email: 'sarah.j@email.com',
                    totalRides: 12,
                    totalSpent: 540.00,
                    avgRating: 5.0,
                    isVIP: true,
                    lastRide: '2025-06-11',
                    preferredLocations: ['Airport Terminal A', 'Downtown Office'],
                    notes: 'Frequent business traveler - always tips well'
                },
                {
                    id: 2,
                    name: 'Mike Rodriguez',
                    phone: '+1 (555) 987-6543',
                    email: 'mike.r@email.com',
                    totalRides: 8,
                    totalSpent: 280.00,
                    avgRating: 4.8,
                    isVIP: false,
                    lastRide: '2025-06-11',
                    preferredLocations: ['City Medical Center'],
                    notes: 'Elderly customer - needs assistance with mobility'
                },
                {
                    id: 3,
                    name: 'Jennifer Lee',
                    phone: '+1 (555) 555-0123',
                    email: 'jenny.lee@email.com',
                    totalRides: 15,
                    totalSpent: 425.00,
                    avgRating: 4.6,
                    isVIP: true,
                    lastRide: '2025-06-11',
                    preferredLocations: ['Shopping Mall Plaza', 'Grocery Store'],
                    notes: 'Regular weekend shopper - likes to chat'
                }
            ];

            console.log('Sample data loaded successfully');
        }

        // Set today's date in forms
        function setTodaysDate() {
            const today = new Date().toISOString().split('T')[0];
            const dateInput = document.getElementById('rideDate');
            if (dateInput) {
                dateInput.value = today;
                dateInput.min = today; // Prevent selecting past dates
            }
        }

        // Update notification badges
        function updateNotificationBadges() {
            const today = new Date().toISOString().split('T')[0];
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowStr = tomorrow.toISOString().split('T')[0];

            const todaysRides = rides.filter(ride => ride.date === today && ride.status === 'scheduled').length;
            const tomorrowsRides = rides.filter(ride => ride.date === tomorrowStr && ride.status === 'scheduled').length;

            const todaysBadge = document.getElementById('todaysBadge');
            const tomorrowsBadge = document.getElementById('tomorrowsBadge');

            if (todaysRides > 0) {
                todaysBadge.textContent = todaysRides;
                todaysBadge.style.display = 'flex';
            } else {
                todaysBadge.style.display = 'none';
            }

            if (tomorrowsRides > 0) {
                tomorrowsBadge.textContent = tomorrowsRides;
                tomorrowsBadge.style.display = 'flex';
            } else {
                tomorrowsBadge.style.display = 'none';
            }
        }

        // Navigation functions
        function showHome() {
            setActiveNav(0);
            // Show home view
        }

        function showToday() {
            setActiveNav(1);
            showTodaysRides();
        }

        function showTomorrow() {
            setActiveNav(2);
            showTomorrowsRides();
        }

        function showFuture() {
            setActiveNav(3);
            showFutureRides();
        }

        function setActiveNav(index) {
            const navItems = document.querySelectorAll('.nav-item');
            navItems.forEach((item, i) => {
                if (i === index) {
                    item.classList.add('active');
                } else {
                    item.classList.remove('active');
                }
            });
        }

        // Modal functions
        function showAddRideModal() {
            document.getElementById('addRideModal').style.display = 'block';
            setTodaysDate();
        }

        function showTodaysRides() {
            const today = new Date().toISOString().split('T')[0];
            const todaysRides = rides.filter(ride => ride.date === today);
            showRidesModal('📅 Today\'s Rides', todaysRides);
        }

        function showTomorrowsRides() {
            const tomorrow = new Date();
            tomorrow.setDate(tomorrow.getDate() + 1);
            const tomorrowStr = tomorrow.toISOString().split('T')[0];
            const tomorrowsRides = rides.filter(ride => ride.date === tomorrowStr);
            showRidesModal('📆 Tomorrow\'s Rides', tomorrowsRides);
        }

        function showFutureRides() {
            const today = new Date();
            const dayAfterTomorrow = new Date();
            dayAfterTomorrow.setDate(today.getDate() + 2);
            const futureRides = rides.filter(ride => new Date(ride.date) >= dayAfterTomorrow);
            showRidesModal('🔮 Future Rides', futureRides);
        }

        function showRidesModal(title, ridesToShow) {
            document.getElementById('ridesModalTitle').textContent = title;
            displayRides(ridesToShow);
            document.getElementById('ridesModal').style.display = 'block';
        }

        function displayRides(ridesToShow) {
            const ridesList = document.getElementById('ridesList');
            
            if (ridesToShow.length === 0) {
                ridesList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">🚗</div>
                        <h3>No rides found</h3>
                        <p>No rides scheduled for this period.</p>
                    </div>
                `;
                return;
            }

            ridesList.innerHTML = ridesToShow.map(ride => `
                <div class="ride-item priority-${ride.priority}">
                    <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                        <div style="flex: 1;">
                            <h4>${ride.customerName}</h4>
                            <p>📞 ${ride.customerPhone}</p>
                            <p>📍 ${ride.pickupLocation}</p>
                            <p>🎯 ${ride.dropoffLocation}</p>
                            <p>⏰ ${ride.date} at ${ride.time}</p>
                            <p>💰 $${ride.price.toFixed(2)}</p>
                            ${ride.notes ? `<p>📝 ${ride.notes}</p>` : ''}
                            ${ride.distance ? `<p>📏 ${ride.distance} • ${ride.duration}</p>` : ''}
                        </div>
                        <div style="text-align: right;">
                            <span class="ride-status status-${ride.status}">${ride.status.toUpperCase()}</span>
                            ${ride.priority === 'high' ? '<div style="color: #f44336; font-weight: bold; margin-top: 5px;">🔥 HIGH PRIORITY</div>' : ''}
                        </div>
                    </div>
                    
                    <div class="ride-actions">
                        <button class="btn-small btn-edit" onclick="editRide(${ride.id})">✏️ Edit</button>
                        ${ride.status === 'scheduled' ? `<button class="btn-small btn-complete" onclick="startRide(${ride.id})">🚗 Start</button>` : ''}
                        ${ride.status === 'in-progress' ? `<button class="btn-small btn-complete" onclick="completeRide(${ride.id})">✅ Complete</button>` : ''}
                        <button class="btn-small btn-cancel" onclick="cancelRide(${ride.id})">❌ Cancel</button>
                    </div>
                    
                    <div class="communication-buttons">
                        <button class="comm-btn call" onclick="callCustomer('${ride.customerPhone}')">📞 Call</button>
                        <button class="comm-btn sms" onclick="smsCustomer('${ride.customerPhone}')">💬 SMS</button>
                        <button class="comm-btn whatsapp" onclick="whatsappCustomer('${ride.customerPhone}')">📱 WhatsApp</button>
                        ${ride.customerEmail ? `<button class="comm-btn email" onclick="emailCustomer('${ride.customerEmail}')">✉️ Email</button>` : ''}
                    </div>
                    
                    <div class="map-container">
                        🗺️ Route from ${ride.pickupLocation} to ${ride.dropoffLocation}
                        <div class="distance-badge">${ride.distance || 'Distance TBD'}</div>
                    </div>
                </div>
            `).join('');
        }

        function showAnalytics() {
            updateAnalytics();
            document.getElementById('analyticsModal').style.display = 'block';
            drawPerformanceChart();
            displayTopCustomers();
        }

        function showCustomers() {
            displayCustomers(customers);
            document.getElementById('customersModal').style.display = 'block';
        }

        function displayCustomers(customersToShow) {
            const customersGrid = document.getElementById('customersGrid');
            
            if (customersToShow.length === 0) {
                customersGrid.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">👥</div>
                        <h3>No customers found</h3>
                        <p>No customers match your search criteria.</p>
                    </div>
                `;
                return;
            }

            customersGrid.innerHTML = customersToShow.map(customer => `
                <div class="customer-card" onclick="showCustomerDetails(${customer.id})">
                    <div class="customer-avatar">${customer.name.split(' ').map(n => n[0]).join('')}</div>
                    <div class="customer-name">${customer.name}</div>
                    <div class="customer-rides">${customer.totalRides} rides • $${customer.totalSpent.toFixed(2)}</div>
                    <div class="rating-stars">⭐ ${customer.avgRating}</div>
                    ${customer.isVIP ? '<div class="badge badge-warning">VIP</div>' : ''}
                    <div style="font-size: 12px; color: #666; margin-top: 5px;">
                        Last ride: ${customer.lastRide}
                    </div>
                </div>
            `).join('');
        }

        function showCustomerDetails(customerId) {
            const customer = customers.find(c => c.id === customerId);
            if (!customer) return;

            currentCustomer = customer;
            
            document.getElementById('customerDetailsTitle').textContent = `👤 ${customer.name}`;
            
            const customerRides = rides.filter(ride => ride.customerName === customer.name);
            
            document.getElementById('customerDetailsContent').innerHTML = `
                <div class="driver-profile">
                    <div class="profile-avatar">${customer.name.split(' ').map(n => n[0]).join('')}</div>
                    <div class="profile-info">
                        <h3>${customer.name} ${customer.isVIP ? '<span class="badge badge-warning">VIP</span>' : ''}</h3>
                        <p>📞 ${customer.phone}</p>
                        <p>✉️ ${customer.email}</p>
                        <div class="rating-stars">⭐ ${customer.avgRating} average rating</div>
                    </div>
                </div>
                
                <div class="analytics-grid">
                    <div class="analytics-card">
                        <div class="analytics-value">${customer.totalRides}</div>
                        <div class="analytics-label">Total Rides</div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-value">$${customer.totalSpent.toFixed(2)}</div>
                        <div class="analytics-label">Total Spent</div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-value">$${(customer.totalSpent / customer.totalRides).toFixed(2)}</div>
                        <div class="analytics-label">Avg per Ride</div>
                    </div>
                    <div class="analytics-card">
                        <div class="analytics-value">${customer.avgRating}</div>
                        <div class="analytics-label">Rating</div>
                    </div>
                </div>
                
                ${customer.preferredLocations ? `
                    <div class="chart-container">
                        <h4>📍 Preferred Locations</h4>
                        ${customer.preferredLocations.map(location => `<span class="badge badge-success" style="margin: 2px;">${location}</span>`).join('')}
                    </div>
                ` : ''}
                
                ${customer.notes ? `
                    <div class="chart-container">
                        <h4>📝 Notes</h4>
                        <p>${customer.notes}</p>
                    </div>
                ` : ''}
            `;

            // Display ride history
            const rideHistoryHtml = customerRides.map(ride => `
                <div class="timeline-item">
                    <div class="timeline-time">${ride.date} at ${ride.time}</div>
                    <div class="timeline-content">
                        ${ride.pickupLocation} → ${ride.dropoffLocation}
                        <div style="margin-top: 5px;">
                            <span class="ride-status status-${ride.status}">${ride.status}</span>
                            <span style="margin-left: 10px; font-weight: normal;">$${ride.price.toFixed(2)}</span>
                        </div>
                        ${ride.feedback ? `<div style="margin-top: 5px; font-style: italic; color: #666;">"${ride.feedback}"</div>` : ''}
                    </div>
                </div>
            `).join('');

            document.getElementById('customerRideHistory').innerHTML = customerRides.length > 0 ? 
                `<div class="timeline">${rideHistoryHtml}</div>` : 
                '<p style="text-align: center; color: #666;">No ride history available</p>';

            document.getElementById('customerDetailsModal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
            if (modalId === 'addRideModal') {
                document.getElementById('addRideForm').reset();
                document.getElementById('photoPreview').style.display = 'none';
            }
        }

        // Ride management functions
        function addRide(event) {
            event.preventDefault();
            
            const formData = new FormData(event.target);
            const newRide = {
                id: rides.length + 1,
                customerName: document.getElementById('customerName').value,
                customerPhone: document.getElementById('customerPhone').value,
                customerEmail: document.getElementById('customerEmail').value,
                pickupLocation: document.getElementById('pickupLocation').value,
                dropoffLocation: document.getElementById('dropoffLocation').value,
                date: document.getElementById('rideDate').value,
                time: document.getElementById('rideTime').value,
                price: parseFloat(document.getElementById('ridePrice').value),
                status: 'scheduled',
                priority: document.getElementById('ridePriority').value,
                notes: document.getElementById('rideNotes').value,
                distance: calculateDistance(),
                duration: calculateDuration()
            };

            rides.push(newRide);
            
            // Update or add customer
            updateCustomerDatabase(newRide);
            
            // Update analytics
            updateAnalytics();
            updateNotificationBadges();
            
            // Close modal and show success
            closeModal('addRideModal');
            showSuccessMessage('✅ Ride added successfully!');
            
            console.log('New ride added:', newRide);
        }

        function updateCustomerDatabase(ride) {
            let customer = customers.find(c => c.phone === ride.customerPhone);
            
            if (customer) {
                // Update existing customer
                customer.totalRides++;
                customer.totalSpent += ride.price;
                customer.lastRide = ride.date;
                customer.avgRating = ((customer.avgRating * (customer.totalRides - 1)) + 5) / customer.totalRides; // Assume 5-star rating for new rides
            } else {
                // Add new customer
                customer = {
                    id: customers.length + 1,
                    name: ride.customerName,
                    phone: ride.customerPhone,
                    email: ride.customerEmail,
                    totalRides: 1,
                    totalSpent: ride.price,
                    avgRating: 5.0,
                    isVIP: false,
                    lastRide: ride.date,
                    preferredLocations: [ride.dropoffLocation],
                    notes: ''
                };
                customers.push(customer);
            }
        }

        function editRide(rideId) {
            const ride = rides.find(r => r.id === rideId);
            if (!ride) return;

            // Populate form with existing data
            document.getElementById('customerName').value = ride.customerName;
            document.getElementById('customerPhone').value = ride.customerPhone;
            document.getElementById('customerEmail').value = ride.customerEmail || '';
            document.getElementById('pickupLocation').value = ride.pickupLocation;
            document.getElementById('dropoffLocation').value = ride.dropoffLocation;
            document.getElementById('rideDate').value = ride.date;
            document.getElementById('rideTime').value = ride.time;
            document.getElementById('ridePrice').value = ride.price;
            document.getElementById('ridePriority').value = ride.priority;
            document.getElementById('rideNotes').value = ride.notes || '';

            // Change form submit to update instead of add
            const form = document.getElementById('addRideForm');
            form.onsubmit = function(event) {
                event.preventDefault();
                updateRide(rideId);
            };

            showAddRideModal();
        }

        function updateRide(rideId) {
            const rideIndex = rides.findIndex(r => r.id === rideId);
            if (rideIndex === -1) return;

            rides[rideIndex] = {
                ...rides[rideIndex],
                customerName: document.getElementById('customerName').value,
                customerPhone: document.getElementById('customerPhone').value,
                customerEmail: document.getElementById('customerEmail').value,
                pickupLocation: document.getElementById('pickupLocation').value,
                dropoffLocation: document.getElementById('dropoffLocation').value,
                date: document.getElementById('rideDate').value,
                time: document.getElementById('rideTime').value,
                price: parseFloat(document.getElementById('ridePrice').value),
                priority: document.getElementById('ridePriority').value,
                notes: document.getElementById('rideNotes').value
            };

            closeModal('addRideModal');
            showSuccessMessage('✅ Ride updated successfully!');
            
            // Reset form submit function
            document.getElementById('addRideForm').onsubmit = addRide;
        }

        function startRide(rideId) {
            const ride = rides.find(r => r.id === rideId);
            if (ride) {
                ride.status = 'in-progress';
                showSuccessMessage(`🚗 Started ride for ${ride.customerName}`);
                updateAnalytics();
                
                // Refresh current view if rides modal is open
                if (document.getElementById('ridesModal').style.display === 'block') {
                    const title = document.getElementById('ridesModalTitle').textContent;
                    if (title.includes('Today')) showTodaysRides();
                    else if (title.includes('Tomorrow')) showTomorrowsRides();
                    else if (title.includes('Future')) showFutureRides();
                }
            }
        }

        function completeRide(rideId) {
            const ride = rides.find(r => r.id === rideId);
            if (ride) {
                ride.status = 'completed';
                showSuccessMessage(`✅ Completed ride for ${ride.customerName}`);
                updateAnalytics();
                updateNotificationBadges();
                
                // Update earnings
                const currentEarnings = parseFloat(document.getElementById('earningsToday').textContent.replace('$', ''));
                document.getElementById('earningsToday').textContent = `$${(currentEarnings + ride.price).toFixed(2)}`;
                
                // Refresh current view
                if (document.getElementById('ridesModal').style.display === 'block') {
                    const title = document.getElementById('ridesModalTitle').textContent;
                    if (title.includes('Today')) showTodaysRides();
                    else if (title.includes('Tomorrow')) showTomorrowsRides();
                    else if (title.includes('Future')) showFutureRides();
                }
            }
        }

        function cancelRide(rideId) {
            if (confirm('Are you sure you want to cancel this ride?')) {
                const ride = rides.find(r => r.id === rideId);
                if (ride) {
                    ride.status = 'cancelled';
                    showSuccessMessage(`❌ Cancelled ride for ${ride.customerName}`);
                    updateAnalytics();
                    updateNotificationBadges();
                    
                    // Refresh current view
                    if (document.getElementById('ridesModal').style.display === 'block') {
                        const title = document.getElementById('ridesModalTitle').textContent;
                        if (title.includes('Today')) showTodaysRides();
                        else if (title.includes('Tomorrow')) showTomorrowsRides();
                        else if (title.includes('Future')) showFutureRides();
                    }
                }
            }
        }

        // Communication functions
        function callCustomer(phone) {
            if (phone || currentCustomer) {
                const phoneNumber = phone || currentCustomer.phone;
                window.open(`tel:${phoneNumber}`);
                showSuccessMessage(`📞 Calling ${phoneNumber}...`);
            }
        }

        function smsCustomer(phone) {
            if (phone || currentCustomer) {
                const phoneNumber = phone || currentCustomer.phone;
                window.open(`sms:${phoneNumber}`);
                showSuccessMessage(`💬 Opening SMS to ${phoneNumber}...`);
            }
        }

        function whatsappCustomer(phone) {
            if (phone || currentCustomer) {
                const phoneNumber = phone || currentCustomer.phone;
                const cleanPhone = phoneNumber.replace(/[^\d]/g, '');
                window.open(`https://wa.me/${cleanPhone}`);
                showSuccessMessage(`📱 Opening WhatsApp to ${phoneNumber}...`);
            }
        }

        function emailCustomer(email) {
            if (email || (currentCustomer && currentCustomer.email)) {
                const emailAddress = email || currentCustomer.email;
                window.open(`mailto:${emailAddress}`);
                showSuccessMessage(`✉️ Opening email to ${emailAddress}...`);
            }
        }

        // Analytics functions
        function updateAnalytics() {
            const completedRides = rides.filter(ride => ride.status === 'completed');
            const totalEarnings = completedRides.reduce((sum, ride) => sum + ride.price, 0);
            const today = new Date().toISOString().split('T')[0];
            const thisWeek = getThisWeekRides();
            const thisMonth = getThisMonthRides();

            // Update analytics display
            if (document.getElementById('totalRides')) {
                document.getElementById('totalRides').textContent = completedRides.length;
                document.getElementById('totalEarnings').textContent = `$${totalEarnings.toFixed(2)}`;
                document.getElementById('avgRating').textContent = '4.8';
                document.getElementById('repeatCustomers').textContent = customers.filter(c => c.totalRides > 1).length;
                document.getElementById('thisWeekRides').textContent = thisWeek.length;
                document.getElementById('avgPrice').textContent = `$${(totalEarnings / Math.max(completedRides.length, 1)).toFixed(2)}`;
                
                document.getElementById('todayRides').textContent = rides.filter(r => r.date === today && r.status === 'completed').length;
                document.getElementById('weeklyEarnings').textContent = `$${thisWeek.reduce((sum, ride) => sum + ride.price, 0).toFixed(2)}`;
                document.getElementById('monthlyRides').textContent = thisMonth.length;
                document.getElementById('customerSatisfaction').textContent = '96%';
            }
        }

        function getThisWeekRides() {
            const today = new Date();
            const weekStart = new Date(today.setDate(today.getDate() - today.getDay()));
            return rides.filter(ride => {
                const rideDate = new Date(ride.date);
                return rideDate >= weekStart && ride.status === 'completed';
            });
        }

        function getThisMonthRides() {
            const today = new Date();
            const monthStart = new Date(today.getFullYear(), today.getMonth(), 1);
            return rides.filter(ride => {
                const rideDate = new Date(ride.date);
                return rideDate >= monthStart && ride.status === 'completed';
            });
        }

        function drawPerformanceChart() {
            const canvas = document.getElementById('performanceChart');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            canvas.width = 400;
            canvas.height = 200;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw simple bar chart
            const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            const earnings = [120, 95, 150, 80, 200, 175, 110];
            const maxEarnings = Math.max(...earnings);
            
            const barWidth = 40;
            const barSpacing = 10;
            const chartHeight = 150;
            const startX = 30;
            const startY = 160;
            
            ctx.fillStyle = '#667eea';
            ctx.font = '12px Arial';
            
            days.forEach((day, index) => {
                const barHeight = (earnings[index] / maxEarnings) * chartHeight;
                const x = startX + index * (barWidth + barSpacing);
                const y = startY - barHeight;
                
                // Draw bar
                ctx.fillRect(x, y, barWidth, barHeight);
                
                // Draw day label
                ctx.fillStyle = '#333';
                ctx.fillText(day, x + 5, startY + 15);
                
                // Draw earnings label
                ctx.fillText(`$${earnings[index]}`, x, y - 5);
                
                ctx.fillStyle = '#667eea';
            });
        }

        function displayTopCustomers() {
            const topCustomers = [...customers]
                .sort((a, b) => b.totalSpent - a.totalSpent)
                .slice(0, 5);
            
            const topCustomersHtml = topCustomers.map((customer, index) => `
                <div style="display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee;">
                    <div style="display: flex; align-items: center; gap: 10px;">
                        <span style="font-weight: bold; color: #667eea;">#${index + 1}</span>
                        <div>
                            <div style="font-weight: 600;">${customer.name}</div>
                            <div style="font-size: 12px; color: #666;">${customer.totalRides} rides</div>
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div style="font-weight: bold;">$${customer.totalSpent.toFixed(2)}</div>
                        <div style="font-size: 12px; color: #666;">⭐ ${customer.avgRating}</div>
                    </div>
                </div>
            `).join('');
            
            document.getElementById('topCustomers').innerHTML = topCustomersHtml;
        }

        // Export functions
        function exportData() {
            document.getElementById('exportModal').style.display = 'block';
        }

        function exportToCSV() {
            const csvData = rides.map(ride => ({
                'Customer Name': ride.customerName,
                'Phone': ride.customerPhone,
                'Email': ride.customerEmail || '',
                'Pickup Location': ride.pickupLocation,
                'Dropoff Location': ride.dropoffLocation,
                'Date': ride.date,
                'Time': ride.time,
                'Price': ride.price,
                'Status': ride.status,
                'Priority': ride.priority,
                'Notes': ride.notes || '',
                'Distance': ride.distance || '',
                'Duration': ride.duration || ''
            }));
            
            const csvContent = convertToCSV(csvData);
            downloadFile(csvContent, 'ktransport360_rides.csv', 'text/csv');
            closeModal('exportModal');
            showSuccessMessage('📊 CSV file downloaded successfully!');
        }

        function exportToPDF() {
            showSuccessMessage('📄 PDF export feature coming soon!');
            closeModal('exportModal');
        }

        function exportCustomers() {
            const csvData = customers.map(customer => ({
                'Name': customer.name,
                'Phone': customer.phone,
                'Email': customer.email,
                'Total Rides': customer.totalRides,
                'Total Spent': customer.totalSpent,
                'Average Rating': customer.avgRating,
                'VIP Status': customer.isVIP ? 'Yes' : 'No',
                'Last Ride': customer.lastRide,
                'Notes': customer.notes || ''
            }));
            
            const csvContent = convertToCSV(csvData);
            downloadFile(csvContent, 'ktransport360_customers.csv', 'text/csv');
            closeModal('exportModal');
            showSuccessMessage('👥 Customer list downloaded successfully!');
        }

        function backupData() {
            const backupData = {
                rides: rides,
                customers: customers,
                analytics: analytics,
                exportDate: new Date().toISOString(),
                appVersion: '2.0'
            };
            
            const jsonContent = JSON.stringify(backupData, null, 2);
            downloadFile(jsonContent, 'ktransport360_backup.json', 'application/json');
            closeModal('exportModal');
            showSuccessMessage('💾 Backup file created successfully!');
        }

        function convertToCSV(data) {
            if (data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const csvRows = [
                headers.join(','),
                ...data.map(row => 
                    headers.map(header => {
                        const value = row[header] || '';
                        return `"${value.toString().replace(/"/g, '""')}"`;
                    }).join(',')
                )
            ];
            
            return csvRows.join('\n');
        }

        function downloadFile(content, fileName, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
        }

        // Search and filter functions
        function filterRides() {
            const searchTerm = document.getElementById('ridesSearch').value.toLowerCase();
            const filteredRides = rides.filter(ride => 
                ride.customerName.toLowerCase().includes(searchTerm) ||
                ride.customerPhone.includes(searchTerm) ||
                ride.pickupLocation.toLowerCase().includes(searchTerm) ||
                ride.dropoffLocation.toLowerCase().includes(searchTerm)
            );
            
            displayRides(filteredRides);
        }

        function filterRidesByStatus(status) {
            // Update active tab
            document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            let filteredRides = rides;
            if (status !== 'all') {
                filteredRides = rides.filter(ride => ride.status === status);
            }
            
            // Apply search filter if active
            const searchTerm = document.getElementById('ridesSearch').value.toLowerCase();
            if (searchTerm) {
                filteredRides = filteredRides.filter(ride => 
                    ride.customerName.toLowerCase().includes(searchTerm) ||
                    ride.customerPhone.includes(searchTerm) ||
                    ride.pickupLocation.toLowerCase().includes(searchTerm) ||
                    ride.dropoffLocation.toLowerCase().includes(searchTerm)
                );
            }
            
            displayRides(filteredRides);
        }

        function filterCustomers() {
            const searchTerm = document.getElementById('customersSearch').value.toLowerCase();
            const filteredCustomers = customers.filter(customer => 
                customer.name.toLowerCase().includes(searchTerm) ||
                customer.phone.includes(searchTerm) ||
                customer.email.toLowerCase().includes(searchTerm)
            );
            
            displayCustomers(filteredCustomers);
        }

        function filterCustomersByType(type) {
            // Update active tab
            document.querySelectorAll('.filter-tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            let filteredCustomers = customers;
            if (type === 'repeat') {
                filteredCustomers = customers.filter(customer => customer.totalRides > 1);
            } else if (type === 'new') {
                filteredCustomers = customers.filter(customer => customer.totalRides === 1);
            } else if (type === 'vip') {
                filteredCustomers = customers.filter(customer => customer.isVIP);
            }
            
            // Apply search filter if active
            const searchTerm = document.getElementById('customersSearch').value.toLowerCase();
            if (searchTerm) {
                filteredCustomers = filteredCustomers.filter(customer => 
                    customer.name.toLowerCase().includes(searchTerm) ||
                    customer.phone.includes(searchTerm) ||
                    customer.email.toLowerCase().includes(searchTerm)
                );
            }
            
            displayCustomers(filteredCustomers);
        }

        // Photo handling functions
        function handlePhotoUpload(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('photoPreview');
                    preview.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            }
        }

        // Utility functions
        function calculateDistance() {
            // Simulate distance calculation
            return `${Math.floor(Math.random() * 20 + 1)}.${Math.floor(Math.random() * 9)} miles`;
        }

        function calculateDuration() {
            // Simulate duration calculation
            return `${Math.floor(Math.random() * 45 + 5)} minutes`;
        }

        function showSuccessMessage(message) {
            // Create success notification
            const notification = document.createElement('div');
            notification.className = 'success-message';
            notification.textContent = message;
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.left = '50%';
            notification.style.transform = 'translateX(-50%)';
            notification.style.zIndex = '10000';
            notification.style.maxWidth = '90%';
            notification.style.textAlign = 'center';
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 3000);
        }

        function showErrorMessage(message) {
            // Create error notification
            const notification = document.createElement('div');
            notification.className = 'error-message';
            notification.textContent = message;
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.left = '50%';
            notification.style.transform = 'translateX(-50%)';
            notification.style.zIndex = '10000';
            notification.style.maxWidth = '90%';
            notification.style.textAlign = 'center';
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                document.body.removeChild(notification);
            }, 3000);
        }

        // Emergency and safety functions
        function triggerEmergency() {
            if (confirm('🚨 Are you sure you want to trigger emergency mode?\n\nThis will:\n• Send emergency alert with your location\n• Contact emergency services\n• Notify emergency contacts')) {
                showSuccessMessage('🚨 Emergency alert sent! Help is on the way.');
                
                // Simulate emergency actions
                console.log('Emergency triggered at:', new Date().toLocaleString());
                console.log('Location: Jacksonville, Florida');
                console.log('Driver: John Driver');
                console.log('Vehicle: Toyota Camry - ABC123');
                
                // In a real app, this would:
                // - Get GPS coordinates
                // - Send SMS/call to emergency contacts
                // - Contact emergency services
                // - Log emergency event
            }
        }

        // Voice command functions
        function toggleVoiceCommand() {
            const voiceBtn = document.getElementById('voiceBtn');
            
            if (!isVoiceListening) {
                startVoiceListening();
                voiceBtn.classList.add('listening');
                voiceBtn.textContent = '🔴';
                showSuccessMessage('🎤 Voice listening activated - say a command');
            } else {
                stopVoiceListening();
                voiceBtn.classList.remove('listening');
                voiceBtn.textContent = '🎤';
                showSuccessMessage('🎤 Voice listening stopped');
            }
        }

        function startVoiceListening() {
            isVoiceListening = true;
            
            // Simulate voice recognition
            setTimeout(() => {
                if (isVoiceListening) {
                    const commands = [
                        'Show today\'s rides',
                        'Add new ride',
                        'Call customer',
                        'Show analytics',
                        'Export data'
                    ];
                    const randomCommand = commands[Math.floor(Math.random() * commands.length)];
                    showSuccessMessage(`🎤 Heard: "${randomCommand}"`);
                    
                    // Execute command
                    executeVoiceCommand(randomCommand);
                    stopVoiceListening();
                }
            }, 3000);
        }

        function stopVoiceListening() {
            isVoiceListening = false;
            const voiceBtn = document.getElementById('voiceBtn');
            voiceBtn.classList.remove('listening');
            voiceBtn.textContent = '🎤';
        }

        function executeVoiceCommand(command) {
            switch (command.toLowerCase()) {
                case 'show today\'s rides':
                    showTodaysRides();
                    break;
                case 'add new ride':
                    showAddRideModal();
                    break;
                case 'show analytics':
                    showAnalytics();
                    break;
                case 'export data':
                    exportData();
                    break;
                default:
                    showSuccessMessage('🎤 Command not recognized');
            }
        }

        // Settings functions
        function toggleDarkMode() {
            isDarkMode = !isDarkMode;
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('darkMode', isDarkMode.toString());
            
            const toggle = event.target;
            toggle.classList.toggle('active');
            
            showSuccessMessage(isDarkMode ? '🌙 Dark mode enabled' : '☀️ Light mode enabled');
        }

        function toggleNotifications() {
            const toggle = event.target;
            toggle.classList.toggle('active');
            const enabled = toggle.classList.contains('active');
            showSuccessMessage(enabled ? '🔔 Notifications enabled' : '🔕 Notifications disabled');
        }

        function toggleAutoBackup() {
            const toggle = event.target;
            toggle.classList.toggle('active');
            const enabled = toggle.classList.contains('active');
            showSuccessMessage(enabled ? '💾 Auto backup enabled' : '💾 Auto backup disabled');
        }

        function toggleVoiceCommands() {
            const toggle = event.target;
            toggle.classList.toggle('active');
            const enabled = toggle.classList.contains('active');
            showSuccessMessage(enabled ? '🎤 Voice commands enabled' : '🎤 Voice commands disabled');
        }

        function toggleGPSTracking() {
            const toggle = event.target;
            toggle.classList.toggle('active');
            const enabled = toggle.classList.contains('active');
            showSuccessMessage(enabled ? '🗺️ GPS tracking enabled' : '🗺️ GPS tracking disabled');
        }

        function resetAppData() {
            if (confirm('⚠️ Are you sure you want to reset all app data?\n\nThis will permanently delete:\n• All rides\n• Customer database\n• Analytics data\n• Settings\n\nThis action cannot be undone!')) {
                rides = [];
                customers = [];
                analytics = {};
                localStorage.clear();
                showSuccessMessage('🔄 App data has been reset');
                updateAnalytics();
                updateNotificationBadges();
            }
        }

        // Route optimization functions
        function acceptRoute() {
            showSuccessMessage('🗺️ Route accepted! Navigation will start shortly.');
            
            // Hide route suggestion
            document.getElementById('routeOptimization').style.display = 'none';
        }

        // Weather and status functions
        function updateWeather() {
            // Simulate weather update
            const temperatures = [65, 70, 75, 80, 85];
            const conditions = ['☀️ Sunny', '⛅ Partly Cloudy', '🌧️ Light Rain', '⛈️ Thunderstorms', '❄️ Snow'];
            
            const temp = temperatures[Math.floor(Math.random() * temperatures.length)];
            const condition = conditions[Math.floor(Math.random() * conditions.length)];
            
            const weatherWidget = document.getElementById('weatherWidget');
            if (weatherWidget) {
                weatherWidget.innerHTML = `
                    <div class="weather-temp">${temp}°F</div>
                    <div class="weather-desc">${condition} - ${getWeatherAdvice(condition)}</div>
                `;
            }
        }

        function getWeatherAdvice(condition) {
            if (condition.includes('Rain') || condition.includes('Thunderstorms')) {
                return 'Drive carefully, roads may be slippery';
            } else if (condition.includes('Snow')) {
                return 'Use extreme caution, check tire condition';
            } else if (condition.includes('Sunny')) {
                return 'Perfect driving weather';
            } else {
                return 'Good driving conditions';
            }
        }

        function checkOfflineStatus() {
            const offlineBanner = document.getElementById('offlineBanner');
            
            if (!navigator.onLine) {
                offlineBanner.style.display = 'block';
            } else {
                offlineBanner.style.display = 'none';
            }
            
            // Listen for online/offline events
            window.addEventListener('online', () => {
                offlineBanner.style.display = 'none';
                showSuccessMessage('📡 Connection restored - data syncing...');
            });
            
            window.addEventListener('offline', () => {
                offlineBanner.style.display = 'block';
            });
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            // Ctrl/Cmd + N: New ride
            if ((event.ctrlKey || event.metaKey) && event.key === 'n') {
                event.preventDefault();
                showAddRideModal();
            }
            
            // Ctrl/Cmd + T: Today's rides
            if ((event.ctrlKey || event.metaKey) && event.key === 't') {
                event.preventDefault();
                showTodaysRides();
            }
            
            // Ctrl/Cmd + E: Export
            if ((event.ctrlKey || event.metaKey) && event.key === 'e') {
                event.preventDefault();
                exportData();
            }
            
            // Escape: Close modals
            if (event.key === 'Escape') {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    if (modal.style.display === 'block') {
                        modal.style.display = 'none';
                    }
                });
            }
        });

        // Close modals when clicking outside
        window.addEventListener('click', function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        });

        // Auto-save functionality
        setInterval(function() {
            // Auto-save data every 30 seconds
            try {
                localStorage.setItem('ktransport360_rides', JSON.stringify(rides));
                localStorage.setItem('ktransport360_customers', JSON.stringify(customers));
                localStorage.setItem('ktransport360_lastSave', new Date().toISOString());
                console.log('Auto-save completed');
            } catch (error) {
                console.warn('Auto-save failed:', error);
            }
        }, 30000);

        // Load saved data on startup
        function loadSavedData() {
            try {
                const savedRides = localStorage.getItem('ktransport360_rides');
                const savedCustomers = localStorage.getItem('ktransport360_customers');
                
                if (savedRides) {
                    rides = JSON.parse(savedRides);
                }
                
                if (savedCustomers) {
                    customers = JSON.parse(savedCustomers);
                }
                
                console.log('Saved data loaded successfully');
            } catch (error) {
                console.warn('Failed to load saved data:', error);
                loadSampleData(); // Fallback to sample data
            }
        }

        // Service Worker for offline functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/sw.js')
                    .then(function(registration) {
                        console.log('SW registered: ', registration);
                    })
                    .catch(function(registrationError) {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // Periodic updates
        setInterval(updateWeather, 300000); // Update weather every 5 minutes
        setInterval(updateNotificationBadges, 60000); // Update badges every minute

        // Initialize app when DOM is ready
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initializeApp);
        } else {
            initializeApp();
        }

        // Performance monitoring
        function logPerformance() {
            if (performance && performance.navigation) {
                const loadTime = performance.navigation.loadEventEnd - performance.navigation.loadEventStart;
                console.log(`App loaded in ${loadTime}ms`);
            }
        }

        window.addEventListener('load', logPerformance);

        // Error handling
        window.addEventListener('error', function(event) {
            console.error('App error:', event.error);
            showErrorMessage('An error occurred. Please refresh the app if problems persist.');
        });

        // Unhandled promise rejection handling
        window.addEventListener('unhandledrejection', function(event) {
            console.error('Unhandled promise rejection:', event.reason);
            event.preventDefault();
        });

        console.log('🚛 KTransport360 Driver App fully loaded and ready!');
        console.log('📱 Version 2.0 - Enhanced with offline capabilities');
        console.log('💾 All data is saved locally on your device');
        console.log('🔧 Press Ctrl+Shift+I to open developer tools');
    </script>
</body>
</html>
